<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Middleware Inventory</title>
	<atom:link href="https://www.middlewareinventory.com/feed/" rel="self" type="application/rss+xml" />
	<link>https://www.middlewareinventory.com</link>
	<description>An inventory of [i]nformation, Middleware and much more.</description>
	<lastBuildDate>Fri, 11 Sep 2020 23:47:13 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>hourly</sy:updatePeriod>
	<sy:updateFrequency>1</sy:updateFrequency>
	<generator>https://wordpress.org/?v=4.9.15</generator>

<image>
	<url>https://www.middlewareinventory.com/wp-content/uploads/2017/12/cropped-Screen-Shot-2017-12-22-at-12.16.54-PM-3-32x32.png</url>
	<title>Middleware Inventory</title>
	<link>https://www.middlewareinventory.com</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Terraform import AWS Security Groups &#8211; Importing Multiple resources</title>
		<link>https://www.middlewareinventory.com/blog/terraform-import-securitygroup-aws/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=terraform-import-securitygroup-aws</link>
		<pubDate>Sat, 05 Sep 2020 21:44:57 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Ansible]]></category>
		<category><![CDATA[AWS]]></category>
		<category><![CDATA[Terraform]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5641</guid>
		<description><![CDATA[<p>In this post, we are going to see how to manage existing and already created AWS Security groups with Terraform. The new era of Infrastructure revolution has begun already and we already started provisioning, managing, administrating our Infra as a code with help of Configuration management tools like Ansible, Terraform,[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/terraform-import-securitygroup-aws/">Terraform import AWS Security Groups &#8211; Importing Multiple resources</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>In this post, we are going to see how to manage existing and already created AWS Security groups with Terraform. The new era of Infrastructure revolution has begun already and we already started provisioning, managing, administrating our Infra as a code with help of Configuration management tools like Ansible, Terraform, SaltStack etc.</p>
<p>If you are new to Terraform and to know how to use Terraform with AWS basics, Refer this article and come back here.</p>
<p>With no further ado, let us jump into today&#8217;s mission.</p>
<h2>The Problem we are trying to Solve</h2>
<p>We know how powerful terraform and how efficient we can manage or create the Entire AWS/GCP/DigitalOcean Cloud Infrastructure with Terraform but we often find ourselves having a few additional resources which are created earlier often manually and not managed by Terraform.</p>
<p>To bring all of these unmanaged resources (security groups) into Terraform and make them as Infra as code. We can use <code>Terraform import</code> command.</p>
<p>But it is not productive to import these resources one by one. So I tried to automate it with Ansible and this is how it goes.</p>
<p>&nbsp;</p>
<h2>Importing and Managing Existing AWS Security Groups with Terraform</h2>
<p>Still, many DevOps engineers are logging into AWS Management console to update the Security group Inbound and Outbound traffic routes manually like opening ports, enabling traffic route etc. There is nothing wrong about it but the problem is you cannot track the changes your team is making unless you have it under revision control. that is where the Infra as code is winning.</p>
<p>Imagine you have your security group as a code and every change you make is properly committed and manged in your Git repositories like BitBucket or Github.  Every change would be tracked with git log and commit message and there would be a backup of the configuration too in case you want to roll back. Not just that. I listed a few reasons why you should be managing your AWS Security group as a code.</p>
<ul>
<li>It enables you to track all your changes like Open/Close ports and the reasons for the changes.</li>
<li>You can do better Security Auditing with Commit messages</li>
<li>Easy and efficient management</li>
<li>Enabling you to automate your infrastructure further</li>
<li>Easily find your publically open routes and prevent any security incident before happening</li>
<li>Better Continuity of Business/Disaster Recovery strategy.</li>
<li>Allow/Disallow IP/Port/Group with a single click of Jenkins job</li>
</ul>
<p>So I cannot insist enough to manage your AWS Security groups as a code. so now let us see how I managed to import my existing AWS security groups ( All of them ) into Terraform and manging it.</p>
<p>Let us see it in a practical way. how it is possible</p>
<p>&nbsp;</p>
<h3>Ansible + Terraform &#8211; to the help</h3>
<p>I am a fan of both Ansible and Terraform, Both are wonderful when it comes to managing the infrastructure, while Ansible is pythonic, Terraform has its own language called Hashicorp Configuration Language and supports JSON too.</p>
<p>The reason why we are going to use Python here is that we are going to fetch all the Security groups and its information using Ansible&#8217;s <code>ec2_group_facts</code> module this can be done with the AWS CLI too but I preferred this way for better data processing.</p>
<p>here is the pictorial representation of how our design is going to be.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport.jpg"><img class="alignnone size-full wp-image-5669" src="https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport.jpg" alt="" width="3475" height="2692" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport.jpg 3475w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport-300x232.jpg 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport-768x595.jpg 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/TerraformImport-1024x793.jpg 1024w" sizes="(max-width: 3475px) 100vw, 3475px" /></a></p>
<p>If you are not able to understand my handwriting in the picture, Here I write the same for additional reference.</p>
<p>In our setup. Ansible playbook is the main component which invokes both Terraform and EC2 data collection using <code>ec2_group_facts</code> module.</p>
<p>For Ansible to be able to access AWS you need to have AWS programmatic access enabled and Authentication keys in your environment variable.</p>
<pre class="hljs">$ <span class="hljs-built_in">export</span> AWS_ACCESS_KEY_ID=AK************IEVXQ
$ <span class="hljs-built_in">export</span> AWS_SECRET_ACCESS_KEY=gbaIbK*********************iwN0dGfS</pre>
<p>This is enough to enable Ansible and Terraform to access your AWS Infrastructure. But however, there are few hidden details and problems you may encounter ( like i did ) you can refer the following articles in case you are stuck or let me know in comments, I will try to help as soon as I can</p>
<ul>
<li><a href="https://www.middlewareinventory.com/blog/ansible-aws-ec2/#Environment_Setup_for_Ansible_to_work_with_AWS_EC2_module">Setup Boto python for Ansible AWS </a></li>
<li><a href="https://www.middlewareinventory.com/blog/terraform-aws-example-ec2/#Setup_Programmatic_Access">Setup programmatic Access for AWS – Key and Secret</a></li>
<li><a href="https://www.middlewareinventory.com/blog/aws-cli-ec2/#Install_AWS_CLI">Install and configure AWS CLI</a></li>
<li><a href="https://www.middlewareinventory.com/blog/terraform-aws-example-ec2/">Terraform AWS Configuration Basics </a></li>
</ul>
<p>Having your environment ready for Ansible and Terraform we can proceed further.</p>
<p><img src="https://www.middlewareinventory.com/wp-content/uploads/2019/03/Screen-Shot-2019-03-31-at-2.20.07-AM.png" /></p>
<p>&nbsp;</p>
<h2>How Ansible and Terraform works together</h2>
<p>Having completed the Access setup for AWS and Ansible integration,  You would be able to reach your AWS account from ansible and execute all AWS related modules.</p>
<p>In this playbook also we are going to use such a module named <code>ec2_group_facts</code> which helps us to fetch all the information about the security groups.  that is going to be our first step</p>
<p>Then we will create a directory for each security group we are fetching from the AWS account and creating the terraform configuration files using the <code>terraform import</code> command and the security group id</p>
<p>Once the import is complete, we need to remove a few configuration elements in the terraform configuration file such as <strong>ownerid, arn, group id</strong> etc, these values/elements should be auto-populated by Terraform so terraform would not let you define it prior.</p>
<p>Once we have removed these auto-generated elements/variables from the configuration file, we are going to validate the file using the <code>terraform validate</code> command</p>
<p>So these are the four steps we are going to perform in order to get all your Security groups managed by Terraform.</p>
<p>&nbsp;</p>
<h2>The Ansible Playbook to import all security groups and add to Terraform</h2>
<p>So, The time has come for some code, Enough with the theory.</p>
<p>Few Points to remember before executing the playbook</p>
<ul>
<li>You need to update the <code>destdir</code> variable where ansible would create new directories for each security group it is fetching. the directory name would be as same the security group name ( if there are spaces in the security group name it would be converted to <code>-</code> hyphen )</li>
<li>You need to replace the vpc-id variable of your corresponding vpc</li>
</ul>
<p>&nbsp;</p>
<p><strong>The Playbook</strong></p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #232323 none repeat scroll 0% 0%; color: #e6e1dc;"><span class="hljs-meta" style="color: #9b859d;">---</span>
<span class="hljs-attr" style="color: #6d9cbe;"> - name:</span> Security Group Playbook
<span class="hljs-attr" style="color: #6d9cbe;">   hosts:</span> localhost
<span class="hljs-attr" style="color: #6d9cbe;">   vars:</span>
<span class="hljs-attr" style="color: #6d9cbe;">      destdir:</span> /apps/gritfy/Terraform/SecGroups
<span class="hljs-attr" style="color: #6d9cbe;">      itemstochange:</span> [<span class="hljs-string" style="color: #a5c261;">'arn\s+=.+$'</span>,<span class="hljs-string" style="color: #a5c261;">'\sid\s+=.+$'</span>,<span class="hljs-string" style="color: #a5c261;">'owner_id\s+=.+$'</span>]

<span class="hljs-attr" style="color: #6d9cbe;">   tasks:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> ec2 security group information fetch
<span class="hljs-attr" style="color: #6d9cbe;">      ec2_group_facts:</span>
<span class="hljs-attr" style="color: #6d9cbe;">        filters:</span>
<span class="hljs-attr" style="color: #6d9cbe;">          vpc-id:</span> vpc<span class="hljs-bullet" style="color: #6d9cbe;">-0</span>a8ae2c90f5ca6cfa
<span class="hljs-attr" style="color: #6d9cbe;">      register:</span> result

<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Creating a dictionary of Security Group IDs and Names
<span class="hljs-attr" style="color: #6d9cbe;">      set_fact:</span> 
<span class="hljs-attr" style="color: #6d9cbe;">        secdict:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ secdict | default ([]) + [ { 'name': item.group_name.replace(' ','-'), 'id': item.group_id } ] }}</span> "</span>
<span class="hljs-attr" style="color: #6d9cbe;">      with_items:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{result.security_groups}}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">      loop_control:</span>
<span class="hljs-attr" style="color: #6d9cbe;">        label:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ item.group_name}}</span>"</span>

<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Create the Directory  
<span class="hljs-attr" style="color: #6d9cbe;">      file:</span>
<span class="hljs-attr" style="color: #6d9cbe;">          path:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{destdir}}</span>/<span class="hljs-template-variable" style="color: #a5c261;">{{item.name}}</span><span class="hljs-template-variable" style="color: #a5c261;">{{item.id[0:7]}}</span>"</span> <span class="hljs-comment" style="color: #bc9458; font-style: italic;"># required. Path to the file being managed.</span>
<span class="hljs-attr" style="color: #6d9cbe;">          state:</span> directory 
<span class="hljs-attr" style="color: #6d9cbe;">      register:</span> dircrt
<span class="hljs-attr" style="color: #6d9cbe;">      loop:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{secdict}}</span>"</span>

<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Terraform Import
<span class="hljs-attr" style="color: #6d9cbe;">      shell:</span> <span class="hljs-string" style="color: #a5c261;">|
        git init
        echo 'provider "aws" {\n\tregion = "us-east-1"\n} \n\nresource  "aws_security_group" "elb_sg" {\n\n}' &gt; main.tf
        terraform init
        terraform import aws_security_group.elb_sg <span class="hljs-template-variable" style="color: #a5c261;">{{item.id}}</span> 
        echo 'provider "aws" {\n\tregion = "us-east-1"\n} \n' &gt; main.tf
        terraform show -no-color &gt;&gt; main.tf
        git add .
        git status
        git commit -m "Updated Git"
        pwd &amp;&amp; ls -lrt
</span><span class="hljs-attr" style="color: #6d9cbe;">      args:</span> 
<span class="hljs-attr" style="color: #6d9cbe;">        chdir:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{destdir}}</span>/<span class="hljs-template-variable" style="color: #a5c261;">{{item.name}}</span><span class="hljs-template-variable" style="color: #a5c261;">{{item.id[0:7]}}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">      loop:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{secdict}}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">      when:</span> dircrt is changed

<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Change config
<span class="hljs-attr" style="color: #6d9cbe;">      lineinfile:</span>
<span class="hljs-attr" style="color: #6d9cbe;">          path:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{destdir}}</span>/<span class="hljs-template-variable" style="color: #a5c261;">{{item.0.name}}</span><span class="hljs-template-variable" style="color: #a5c261;">{{item.0.id[0:7]}}</span>/main.tf"</span>
<span class="hljs-attr" style="color: #6d9cbe;">          regexp:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ item.1 }}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">          state:</span> absent
<span class="hljs-attr" style="color: #6d9cbe;">          backup:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">      with_nested:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">        -</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ secdict }}</span>"</span>
<span class="hljs-bullet" style="color: #6d9cbe;">        -</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ itemstochange }}</span>"</span>
      
<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Terraform Validate
<span class="hljs-attr" style="color: #6d9cbe;">      shell:</span> <span class="hljs-string" style="color: #a5c261;">|
        terraform validate 
</span><span class="hljs-attr" style="color: #6d9cbe;">      args:</span>
<span class="hljs-attr" style="color: #6d9cbe;">        chdir:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{destdir}}</span>/<span class="hljs-template-variable" style="color: #a5c261;">{{item.name}}</span><span class="hljs-template-variable" style="color: #a5c261;">{{item.id[0:7]}}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">      loop:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{secdict}}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">      register:</span> tfvalidate
<span class="hljs-attr" style="color: #6d9cbe;">      failed_when:</span> <span class="hljs-string" style="color: #a5c261;">"'Success' not in tfvalidate.stdout"</span>
</pre>
<p>&nbsp;</p>
<h2>Ansible Playbook tasks explained</h2>
<p>Let us go through the playbook and understand what each task is designed to do.</p>
<h3><span style="color: #0b4f70;"><strong>Task1: EC2 information fetch</strong></span></h3>
<p>This task is using the module named <code>ec2_group_facts</code> and it uses the AWS access key and secret from your environment directly to connect to your AWS account and fetch all the security groups belong to the specific <code>vpc</code> which is mentioned in the arguments.  make sure to update the <code>vpc-id</code> filter value before running the playbook.</p>
<p>&nbsp;</p>
<h3><strong><span style="color: #0b4f70;">Task2:  Creating a Dictionary with the Collected Values </span><br />
</strong></h3>
<p>ec2_group_facts module would result in a lot of information about the security group but all we need is a <code>security group name</code> and <code>security group id</code></p>
<p>So we are iterating through the collected output from the previous task and creating a dictionary named <code>secdict</code> we are using <code>set_fact</code> module to create a variable during the runtime</p>
<p>&nbsp;</p>
<h3><strong><span style="color: #0b4f70;">Task3:  Creating a Directory for each security group &#8211; Naming Convention</span> </strong></h3>
<p>As mentioned earlier, we would be creating dedicated directories for each security group where the Terraform configuration file of that corresponding sec group would be saved.</p>
<p>The Name of this directory would be combo of the security group name and the first 7 characters of the security group id, this is to avoid duplicates. AWS does not have unique name constraint for the security group naming, so there can be one more security groups with the same name.</p>
<p>&nbsp;</p>
<h3><span style="color: #0b4f70;"><strong>Task4:  Terraform Importing tasks<br />
</strong></span></h3>
<p>in this task, we are running multiple commands one after another just like we type in a shell prompt. using <a href="https://www.middlewareinventory.com/blog/ansible-shell-examples/">ansible shell module</a>  These are list of tasks we are going to do with this task</p>
<ol>
<li>we initialize a git repo under the newly created sec group directory</li>
<li>create a terraform configuration file named <code>main.tf</code> with AWS provider specifications</li>
<li>Performing <code>terraform init</code> to initialize terraform on the directory</li>
<li>Performing the import process with <code>terraform import</code> command and the corresponding security group&#8217;s id</li>
<li>Writing the imported configuration back into <code>main.tf</code> configuration file we have created at step2</li>
<li>Rest of the steps are for version controlling changes like add, commit etc.</li>
</ol>
<p>&nbsp;</p>
<h3><span style="color: #0b4f70;"><strong>Task5:  Terraform file correction and removing the unwanted fields<br />
</strong></span></h3>
<p>In this task, we are removing the unwanted lines from the created <code>main.tf</code> configuration file which otherwise makes the file syntactically incorrect</p>
<h3></h3>
<h3><strong><span style="color: #0b4f70;">Task6:  Validate the configuration after the changes</span><br />
</strong></h3>
<p>Finally, we can validate if the Terraform configuration file <code>main.tf</code> is valid for each security group using the <code>terraform validate</code> command which would be executed inside all the security group directories. It has been designed to fail when the validate command returns a failure message using ansible <a href="https://www.middlewareinventory.com/blog/ansible-changed_when-and-failed_when-examples/">failed_when</a></p>
<h3></h3>
<h2>Playbook Execution and Result</h2>
<p>If you have done everything correct. You would be able to import all the security groups belong to the specific VPC in your AWS account and would be able to manage using Terraform.</p>
<p>You would have directories created with the security group names beneath the workspace(destdir) directory you have defined in the playbook</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM.png"><img class="alignnone size-full wp-image-5681" src="https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM.png" alt="" width="2438" height="1720" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM.png 2438w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM-300x212.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM-768x542.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/09/Screenshot-2020-09-06-at-1.51.24-AM-1024x722.png 1024w" sizes="(max-width: 2438px) 100vw, 2438px" /></a></p>
<p>&nbsp;</p>
<h2>Make Changes in Terraform File and Apply it to verify</h2>
<p>Once the configuration files are imported and ready go to any of the security group directory created and edit the <code>main.tf</code> file and make changes like adding a new ingress rule or changing the CIDR IP address for the allowed port number etc</p>
<p>Once you have done the changes. you are good to go and <code>terraform plan</code> and then <code>terraform apply</code> it</p>
<p>You would be able to see that your security group is successfully managed by Terraform.</p>
<p>Any further change you would like to make to the security group can be done with Terraform Infrastructure as code technique. (Refer the video for more information)</p>
<p>Congratulations.</p>
<p>&nbsp;</p>
<h2>Video Guide &#8211; Screen record</h2>
<p>Here is the screen record of me, talking about this setup and testing this playbook in my aws account.</p>
<p><iframe width="840" height="630" src="https://www.youtube.com/embed/IyrGFo4Se5c?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<p>&nbsp;</p>
<p>Hope this article is helpful</p>
<p>&nbsp;</p>
<p>Cheers<br />
Sarav AK சரவணன் அ.க</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/terraform-import-securitygroup-aws/">Terraform import AWS Security Groups &#8211; Importing Multiple resources</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Ansible Route53 Examples &#8211; read add remove update DNS records</title>
		<link>https://www.middlewareinventory.com/blog/aws-route53-ansible/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=aws-route53-ansible</link>
		<pubDate>Mon, 10 Aug 2020 11:04:47 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Ansible]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5617</guid>
		<description><![CDATA[<p>In this post, we are going to see how to add and remove records in AWS route53 DNS using ansible. If you are an AWS architect or a developer/devops executive managing your infrastructure hosted in AWS. you might have used the AWS route53 DNS web service. with route53 you can[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/aws-route53-ansible/">Ansible Route53 Examples &#8211; read add remove update DNS records</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>In this post, we are going to see how to add and remove records in AWS route53 DNS using ansible.</p>
<p>If you are an AWS architect or a developer/devops executive managing your infrastructure hosted in AWS. you might have used the AWS route53 DNS web service. with route53 you can create <strong>private</strong> and <strong>public</strong> domain name services.</p>
<p>For example, If you want to have your entire infrastructure servers to have their internally available domain names like <code>server1.gritfy.infra</code> , <code>server2.gritfy.infra</code> and you can also use route53 as your DNS server for your publically available sites like <code>gritfy.com</code> and <code>devopsjunction.com</code></p>
<p>we use AWS management console for these tasks usually. But using the AWS management console often is not a secure and efficient way. Here comes ansible an efficient automation tool to take care of your provisioning and configuration management tasks.</p>
<h2>Configure <span style="color: #e82c7e;">Ansible</span> to work with AWS modules</h2>
<p>For ansible to connect amazon web services infrastructure you need to enable programmatic access first and get your AWS access key and secret key</p>
<p>Refer the following article to get your Key and Secret ready.  Besides that,  you would also need to check if you have the right version python installed in your control machine with boto packages. As ansible uses boto package to connect to the aws.</p>
<ol>
<li><a href="https://www.middlewareinventory.com/blog/terraform-aws-example-ec2/#Setup_Programmatic_Access">How to create Programmatic access &#8211; Key and Secret</a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-aws-ec2/#Environment_Setup_for_Ansible_to_work_with_AWS_EC2_module">How to setup Boto python module for Ansible aws module</a></li>
</ol>
<p>&nbsp;</p>
<h2>Ansible <span style="color: #e82c7e;">Route53 examples</span> to read add remove update DNS records</h2>
<p>let us see the examples on how to use the route53 ansible module to read add remove and update the DNS records.  Simply put we are going to see how to perform the CRUD (Create Read Update Delete) tasks.</p>
<p>Before proceeding further, I presume that you are well aware of the DNS records and its types. Ansible supports all the <a href="https://www.cloudflare.com/learning/dns/dns-records/">DNS record types</a> such as</p>
<ul>
<li>A</li>
<li>CNAME</li>
<li>MX</li>
<li>AAAA</li>
<li>TXT</li>
<li>PTR</li>
<li>SRV</li>
<li>SPF</li>
<li>CAA</li>
<li>NS</li>
<li>SOA</li>
</ul>
<p>with no further ado let us go the practical implementation of adding, removing, retrieving and deleting DNS records of various types mentioned above.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>How to <span style="color: #e82c7e;">READ/RETRIEVE</span> the DNS records from AWS route53 &#8211; Ansible</h3>
<p>In this section we are going to see, How to read or retrieve the DNS records from AWS route53 DNS service using the ansible route53 module.</p>
<p>Create an ansible playbook with the following content</p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>
<span class="hljs-attr" style="color: #795da3;">    - name:</span> Route <span class="hljs-number">53</span> A Record addition
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> get
<span class="hljs-attr" style="color: #795da3;">        private_zone:</span> <span class="hljs-literal" style="color: #0086b3;">yes</span>
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.infra
<span class="hljs-attr" style="color: #795da3;">        record:</span> server01.ffx.infra
<span class="hljs-attr" style="color: #795da3;">        type:</span> A
<span class="hljs-attr" style="color: #795da3;">      register:</span> record

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display the record
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=record</pre>
<p>In this playbook, we are trying to get the A record <code>server01.ffx.infra</code> since this is a private zone we are using the parameter <code>private_zone: yes</code> which is otherwise by default stays <code>no</code></p>
<p>If it is a public zone like <code>gritfy.com</code> the playbook would be exactly the same except there would not any private_zone parameter.</p>
<p>This playbook is designed to get the CNAME record of <code>www.grtify.com</code> from the zone <code>gritfy.com</code></p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>
<span class="hljs-attr" style="color: #795da3;">    - name:</span> Retrieve the Record
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> get
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> www.gritfy.com
<span class="hljs-attr" style="color: #795da3;">        type:</span> CNAME
<span class="hljs-attr" style="color: #795da3;">      register:</span> record

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display the record
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=record</pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p>Here is the sample result you can expect while retrieving the DNS records using the route53 module.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53.png"><img class="alignnone size-full wp-image-5622" src="https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53.png" alt="" width="2156" height="1696" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53.png 2156w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53-300x236.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53-768x604.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/AnsibleRoute53-1024x806.png 1024w" sizes="(max-width: 2156px) 100vw, 2156px" /></a></p>
<p>&nbsp;</p>
<h3>How to <span style="color: #e82c7e;">ADD/CREATE</span> DNS records to AWS route53 using Ansible</h3>
<p>In this section, we are going to see how to add a DNS record to route53 DNS service using the ansible route53 module.</p>
<p>Here is the playbook to add the DNS records</p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>
<span class="hljs-attr" style="color: #795da3;">    - name:</span> Route <span class="hljs-number">53</span> A Record addition
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> present
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> testrecord.gritfy.com
<span class="hljs-attr" style="color: #795da3;">        type:</span> A
<span class="hljs-attr" style="color: #795da3;">        ttl:</span> <span class="hljs-number">300</span>
<span class="hljs-attr" style="color: #795da3;">        value:</span> <span class="hljs-number">172.99</span><span class="hljs-number">.1</span><span class="hljs-number">.82</span>
<span class="hljs-attr" style="color: #795da3;">        wait:</span> <span class="hljs-literal" style="color: #0086b3;">yes</span>
<span class="hljs-attr" style="color: #795da3;">      register:</span> result

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display records
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=result</pre>
<p>Execution result of this playbook would look something like this</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM.png"><img class="alignnone size-full wp-image-5623" src="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM.png" alt="Ansible Route53" width="2112" height="862" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM.png 2112w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM-300x122.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM-768x313.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-10.06.46-AM-1024x418.png 1024w" sizes="(max-width: 2112px) 100vw, 2112px" /></a></p>
<p>&nbsp;</p>
<p>A quick look at the parameters used along with the route53 module.</p>
<p><code>state</code> &#8211; to tell ansible to create or remove the records. we are creating here so the value is present</p>
<p><code>zone</code> &#8211; domain name / zone name in the aws infrastructure.</p>
<p><code>record</code> &#8211; the DNS record we are trying to work with</p>
<p><code>type</code> &#8211; type of the record</p>
<p><code>ttl</code> &#8211; time to live value of the domain name record. AWS supports creating records with very low values like 300 seconds</p>
<p><code>value</code> &#8211; the IP address or the record value for the type of record we have chosen</p>
<p><code>wait</code> &#8211; wait for the record to be created before exiting the playbook.  With this parameter set playbook would continue to run until the route53 record gets created or failed.</p>
<p>&nbsp;</p>
<h3>How to <span style="color: #e82c7e;">UPDATE</span> DNS records in AWS route53 using Ansible</h3>
<p>In this section, we are going to see how to update the DNS records we have already created and overwrite.  Let us take the same DNS record we have added in the last section <code>testrecord.gritfy.com</code> earlier it was pointing to the IP <code>172.99.1.82</code> Now let us change the IP to something else.</p>
<p>here is the playbook to update the DNS records and overwrite the existing the record information like ip, ttl value etc.</p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>
<span class="hljs-attr" style="color: #795da3;">    - name:</span> Route <span class="hljs-number">53</span> A Record Update
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> present
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> testrecord.gritfy.com
<span class="hljs-attr" style="color: #795da3;">        type:</span> A
<span class="hljs-attr" style="color: #795da3;">        ttl:</span> <span class="hljs-number">300</span>
<span class="hljs-attr" style="color: #795da3;">        value:</span> <span class="hljs-number">172.99</span><span class="hljs-number">.2</span><span class="hljs-number">.211</span>
<span class="hljs-attr" style="color: #795da3;">        wait:</span> <span class="hljs-literal" style="color: #0086b3;">yes</span>
<span style="color: #993300;"><span class="hljs-attr">        overwrite:</span> <span class="hljs-literal">yes</span></span>
<span class="hljs-attr" style="color: #795da3;">      register:</span> result

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display records
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=result</pre>
<p>Since we have already covered the route53 parameters already in the previous section, let us check what is newly added in this playbook.</p>
<p><code>overwrite</code> &#8211; this tells ansible to overwrite the already existing record. it enables the in-place update possible</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3>How to <span style="color: #e82c7e;">DELETE</span> DNS records in AWS route53 using Ansible</h3>
<p>To delete existing records in the AWS route53 using ansible route53 module. we can use the same playbook we have used to create the DNS record except that you have to change the value of state parameter to <code>absent</code></p>
<p>Here is the playbook to delete the DNS records in AWS route 53 using Ansible</p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>
<span class="hljs-attr" style="color: #795da3;">    - name:</span> Route <span class="hljs-number">53</span> A Record addition
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span style="color: #993300;"><span class="hljs-attr">        state:</span> absent</span>
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> testrecord.gritfy.com
<span class="hljs-attr" style="color: #795da3;">        type:</span> A
<span class="hljs-attr" style="color: #795da3;">        ttl:</span> <span class="hljs-number">300</span>
<span class="hljs-attr" style="color: #795da3;">        value:</span> <span class="hljs-number">172.99</span><span class="hljs-number">.1</span><span class="hljs-number">.211</span>
<span class="hljs-attr" style="color: #795da3;">        wait:</span> <span class="hljs-literal" style="color: #0086b3;">yes</span>
<span class="hljs-attr" style="color: #795da3;">      register:</span> result

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display records
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=result</pre>
<p>The problem with this playbook is that you have to enter all the fields manually.  If the values specified are incorrect than the values available on the AWS route 53 you would get an error like this</p>
<pre>fatal: [localhost]: FAILED! =&gt; 
{"changed": false, "msg": "[Tried to delete resource record set 
[name='testrecord.gritfy.com.', type='A'] 
but the values provided do not match the current values]"}</pre>
<p>&nbsp;</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p><strong>The right approach to READ and DELETE the records</strong></p>
<p>Rather filling all the values manually, which often result in some human typo or error.  we can first read the DNS record and store the values in the register variable and use those values during the delete operation, in this way we avoid having to remember the values and filling it manually.</p>
<pre class="hljs" style="display: block; background: #ffffff none repeat scroll 0% 0%; padding: 0.5em; color: #333333; overflow-x: auto;"><span class="hljs-meta" style="color: #969896;">---</span>
<span class="hljs-attr" style="color: #795da3;"> - hosts:</span> localhost
<span class="hljs-attr" style="color: #795da3;">   tasks:</span>

<span class="hljs-attr" style="color: #795da3;">    - name:</span> Retrieve the Records First
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> get
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> testrecord.gritfy.com
<span class="hljs-attr" style="color: #795da3;">        type:</span> A
<span class="hljs-attr" style="color: #795da3;">      register:</span> rec

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display the record
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=rec

<span class="hljs-attr" style="color: #795da3;">    - name:</span> Route <span class="hljs-number">53</span> Delete Records
<span class="hljs-attr" style="color: #795da3;">      route53:</span>
<span class="hljs-attr" style="color: #795da3;">        state:</span> absent
<span class="hljs-attr" style="color: #795da3;">        zone:</span> gritfy.com
<span class="hljs-attr" style="color: #795da3;">        record:</span> <span class="hljs-string" style="color: #df5000;">"<span class="hljs-template-variable" style="color: #df5000;">{{ rec.set.record }}</span>"</span>
<span class="hljs-attr" style="color: #795da3;">        type:</span> <span class="hljs-string" style="color: #df5000;">"<span class="hljs-template-variable" style="color: #df5000;">{{ rec.set.type }}</span>"</span>
<span class="hljs-attr" style="color: #795da3;">        ttl:</span> <span class="hljs-string" style="color: #df5000;">"<span class="hljs-template-variable" style="color: #df5000;">{{ rec.set.ttl }}</span>"</span>
<span class="hljs-attr" style="color: #795da3;">        value:</span> <span class="hljs-string" style="color: #df5000;">"<span class="hljs-template-variable" style="color: #df5000;">{{ rec.set.value }}</span>"</span>
<span class="hljs-attr" style="color: #795da3;">        wait:</span> <span class="hljs-literal" style="color: #0086b3;">yes</span>
<span class="hljs-attr" style="color: #795da3;">      register:</span> result

<span class="hljs-attr" style="color: #795da3;">    - name:</span> display results
<span class="hljs-attr" style="color: #795da3;">      debug:</span> var=result
</pre>
<p>In this playbook, we are reading the DNS record first and storing in a register variable named <code>rec</code> and using the variable in the next task to delete the record.</p>
<p>We have a debug task after  READ and DELETE operation to show more details on this job</p>
<p>here is the execution result of this playbook</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1.png"><img class="alignnone size-full wp-image-5626" src="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1.png" alt="ansible route53" width="2250" height="1868" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1.png 2250w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1-300x249.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1-768x638.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/08/Screenshot-2020-08-10-at-4.11.53-PM-1-1024x850.png 1024w" sizes="(max-width: 2250px) 100vw, 2250px" /></a></p>
<p>&nbsp;</p>
<h2>Conclusion</h2>
<p>with Ansible route 53 module you can create, delete, update and read all types of DNS records and work with it.   In this article, we have covered all CRUD tasks with ansible route53 module.  If you have any questions or comments let me know on the comments section</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/aws-route53-ansible/">Ansible Route53 Examples &#8211; read add remove update DNS records</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Postfix SMTP relay to Office 365 &#8211; Single and Multiple SMTP Servers</title>
		<link>https://www.middlewareinventory.com/blog/postfix-relay-office-365/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=postfix-relay-office-365</link>
		<pubDate>Fri, 31 Jul 2020 07:17:13 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Office365]]></category>
		<category><![CDATA[Unix]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5589</guid>
		<description><![CDATA[<p>Postfix is a powerful opensource mail server with a lot of customization options available built-in. I recently had a requirement to set up an Organization-wide mail server to perform SMTP relay to Office365 and allow our Java, JS, Python applications to send emails from different office365 email ids based on[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/postfix-relay-office-365/">Postfix SMTP relay to Office 365 &#8211; Single and Multiple SMTP Servers</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>Postfix is a powerful opensource mail server with a lot of customization options available built-in. I recently had a requirement to set up an Organization-wide mail server to perform SMTP relay to Office365 and allow our Java, JS, Python applications to send emails from different office365 email ids based on the Subject (or) the sender details.</p>
<p>Before we think about the multiple email IDs and sender-based relay in postfix. Let us cover the basic setup and send our test emails.</p>
<p>I am going to split this article into four parts or subtopics</p>
<ol>
<li>Configuring Postfix SMTP relay to Office 365 and testing it with Single email ID/Domain</li>
<li>Configuration Postfix SMTP relay for multiple domains and sender-based relay</li>
<li>Troubleshooting SMTP relay and Fixing Email Delivery Problems</li>
<li>Check your email Score (or) Spam test result</li>
</ol>
<p>Before we proceed with these three steps I would like to take you on a quick tour around the three different connection methodologies you can have with Office365. Knowing which one you are using would help you to fix the problems faster when you run into one.</p>
<p>&nbsp;</p>
<h2><span style="color: #003366;">Three types of Integration supported by <span style="color: #e31974;">Office365</span>.</span></h2>
<p>If you browse through the internet you would find numerous articles with different methods to set up SMTP relay from POSTFIX or to connect your application or device and relay your mails. So I am listing out the three different types of integrations we can do with Office365 to send emails.</p>
<h3><strong>1. SMTP client submission<br />
</strong></h3>
<p>The client should be connected to the Server &#8220;smtp.office365.com&#8221; on port 587 and in this approach, we can send emails to internal and external recipients</p>
<figure style="width: 611px" class="wp-caption alignnone"><img src="https://docs.microsoft.com/en-us/exchange/exchangeonline/media/d5c5a7fa-aba4-4bf4-976f-4c7128fcab2d.png" alt="Shows how a multifunction printer connects to Microsoft 365 or Office 365 using SMTP client submission." width="611" height="420" data-linktype="relative-path" /><figcaption class="wp-caption-text">Image Credits to Microsoft</figcaption></figure>
<h3><strong>2. Direct send</strong></h3>
<p>In this method, we are connected to our Organization Mail Server hostname (MX) whose name ends with &#8220;mail.protection.outlook.com&#8221;</p>
<p>In my case, <span id="lblResult"><a href="https://mxtoolbox.com/SuperTool.aspx?action=mx:gritfy.com#">gritfy-com.mail.protection.outlook.com</a></span> is my mail server. to find out your organization&#8217;s mail server MX record use <a href="https://mxtoolbox.com/">https://mxtoolbox.com/</a></p>
<p>With this method, email cannot be sent to recipients outside your organization</p>
<p><img src="https://docs.microsoft.com/en-us/exchange/exchangeonline/media/cb07aae7-ca31-43a7-a468-74c293b37a66.png" alt="Shows how a multifunction printer uses your Microsoft 365 or Office 365 MX endpoint to send email directly to recipients in your organization only." data-linktype="relative-path" /></p>
<h3><strong>3. Office 365 SMTP relay ( Discussed in this Post )<br />
</strong></h3>
<p>In this method, we are connected to our Organization Mail Server hostname (MX) whose name ends with &#8220;mail.protection.outlook.com&#8221;</p>
<p>There is a connector set up in Office 365 for emails sent from your organization&#8217;s mail server. In our case it is postfix.</p>
<p>In this method, we can send mail to external recipients as well as internal organization.</p>
<p><img src="https://docs.microsoft.com/en-us/exchange/exchangeonline/media/258cb8b1-752d-47b8-91e9-a0176dfcfad4.png" alt="Shows how a multifunction printer connects to Microsoft 365 or Office 365 using SMTP relay." data-linktype="relative-path" /></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2><span style="color: #003366;">Simple <span style="color: #e31974;">SMTP relay</span> with Postfix Office365</span></h2>
<p>As shown in the preceding method 3, we are going to set up an SMTP relay with Connectors in Office365 and Postfix to send emails to internal and external recipients.</p>
<p>Let us start from installing the postfix mail server in your Linux host.  you have to choose your appropriate package manager like <code>yum</code> or <code>apt-get</code></p>
<h3>Installing postfix mail server</h3>
<p>In my case, it is CentOS so I am going with yum</p>
<pre>yum install postfix</pre>
<h3></h3>
<h3>Update the Postfix configuration</h3>
<p>If you goto the <code>/etc/postfix</code> directory and list the files, you would find a set of configuration files already present and we are going to update some of the configurations to make the SMTP relay work through the office365</p>
<h4><strong>Updating Relay Host in postfix configuration</strong></h4>
<p>the first file we are going to make changes is <code>main.cf</code> file and you have to find and update the parameter named <code>relay_host=</code> if it is commented, Uncomment it</p>
<p>You are going to use your Organization MX Server endpoint in there with the port number 25, In my case it is</p>
<pre>relayhost = [gritfy-com.mail.protection.outlook.com]:25</pre>
<h4></h4>
<h4><strong>Updating SMTP Outbound Relay configuration</strong></h4>
<p>In the same <code>main.cf</code> file add the following lines at the end of the file, The configuration is to enable a Security using sasl_passwd file where we would be defining our email and password. We can also configure the outbound mail to be encrypted with TLS using <code>smtp_tls_security_level</code> option but in this post, we are going without TLS</p>
<pre>smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
smtp_sasl_security_options = noanonymous	 	 
smtp_tls_security_level = may	 	 
header_size_limit = 409600</pre>
<p>So we have defined the <code>password_maps</code> file within the main.cf file but have not created it yet. so our next step is to create one and it should be on the <code>/etc/postfix</code> directory with the name <code>sasl_passwd</code></p>
<p>&nbsp;</p>
<h4><strong>Creating sasl_passwd file with Authentication info</strong></h4>
<p>Create a new file named sasl_passwd under /etc/postfix and enter your Office365 account details.</p>
<p>It is recommended that this account does not have admin privileges as the <code>sasl_passwd</code> file would contain this password as cleartext.</p>
<p>Here is the content of my sasl_passwd file for your reference.</p>
<pre>[gritfy-com.mail.protection.outlook.com]:25 username@gritfy.com:SecurePassword</pre>
<p>Postfix reads the login info from the Database file so it is necessary that we should convert this file to a *.db format. In order to do that</p>
<p>you can use the command</p>
<pre>postmap /etc/postfix/sasl_passwd</pre>
<p>upon the successful execution of this command, you can see a new file would be created in the same name with <code>.db</code> extension</p>
<p>By default, these files would have the global read permissions which let all logged-in user to the server read the files. to prevent it, you can consider setting up some file permissions like shown below. this would enable only owners to read and write the file and restrict all others</p>
<pre>sudo chmod 0600 /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db</pre>
<p>Now we have configured the postfix mail server but since we are using the SMTP relay method of Office365 integration, we need to create our Office365 connector which requires Office365 Admin privileges.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3>Creating  Connector in Office365</h3>
<p>To create a connector in Office365 you need to have Global Admin or Exchange Admin role.</p>
<p>Login to Office365 Exchange Admin page and under <code>mail flow</code> option you would find an option named <code>connectors</code> click on it to create a new connector</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM.png"><img class="alignnone size-full wp-image-5595" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM.png" alt="" width="2494" height="1640" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM.png 2494w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM-300x197.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM-768x505.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM-1024x673.png 1024w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-27-at-3.59.53-AM-120x80.png 120w" sizes="(max-width: 2494px) 100vw, 2494px" /></a></p>
<p>Once you have clicked on the Connectors, you would be prompted few details where you need to either choose the Connector to allow the clients based on the Certificate or by the IP.</p>
<p>In this post, we are going with the IP method where Office365 Connector would allow the client applications like Postfix to send emails when they are from a specific public IP address.</p>
<p>So if you are implementing this in your Organization it is advised that you have a static public IP enabled for your Linux server. for AWS users it is even simple, as you can allocate an Elastic IP for your instance where you are setting this up.</p>
<p>Take a look at this Screen record of me doing the same setup.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/ezgif.com-optimize.gif"><img class="alignnone size-full wp-image-5596" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/ezgif.com-optimize.gif" alt="Office 365 Relay Postfix" width="1396" height="710" /></a></p>
<p>&nbsp;</p>
<h3>Updating SPF record with your public IP ( to avoid your email ending as SPAM )</h3>
<p>All the steps we have done till now is enough to get your email going out from Postfix relay.</p>
<p>We should do one more thing to save our emails getting ended up into the SPAM folder.</p>
<p>If you are in the AWS world, you can do it easily in Route53. if you are in public providers like GoDaddy and Bluehost you need to find their own technical documentation on how to add this new SPF record.</p>
<p>Basically our objective here is to add our public ipv4 IP to the SPF record. It would look something like this, you can keep adding many ipv4 records as you add more</p>
<pre class="alert alert-success">v=spf1 ip4:49.205.79.85 include:spf.protection.outlook.com -all</pre>
<p>To create SPF records in the right syntax you can use <a href="https://mxtoolbox.com/SPFRecordGenerator.aspx">SPF record generator</a></p>
<p>To validate your SPF record you can use this <a href="https://mxtoolbox.com/SuperTool.aspx">mxtoolbox supertool</a></p>
<p>&nbsp;</p>
<h3>Whitelist your Server URL in the office365</h3>
<p>Also, you need to whitelist your Server IP for the Office365 to accept your connection request on port 25 and to honour your mail submission</p>
<p>Exchange Admin Center -&gt; Connection Filter -&gt; Add Allowed IP Address</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Office365-ip-1.gif"><img class="alignnone size-full wp-image-5603" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Office365-ip-1.gif" alt="" width="1610" height="816" /></a></p>
<p>If your IP is not whitelisted, You might see some errors like given below.</p>
<pre>Jul 30 22:35:57 mwiapp01 postfix/smtp[18821]: AC8A74078131: 
to=&lt;someemail@gmail.com&gt;, 
relay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25, 
delay=5.9, delays=0.09/0.05/4.1/1.6, dsn=5.7.750, 
status=bounced (host gritfy-com.mail.protection.outlook.com[104.47.100.36] 
said: 550 5.7.750 Service unavailable. 
Client blocked from sending from unregistered domains. 
For more information please go to http://go.microsoft.com/fwlink/?LinkId=526653. AS(800051) 
[MA1IND01FT006.eop-IND01.prod.protection.outlook.com] (in reply to end of DATA command))</pre>
<p>&nbsp;</p>
<h3>Restart Postfix and Send some email to test it</h3>
<p>Now go back to the server and restart your postfix using your <code>systemctl</code> or <code>service</code> command and after validating the services are started. you can send yourself a test email to validate your setup</p>
<pre>echo "Some Email to Test"|mailx -s "Test Email" -r username@gritfy.com someemail@gmail.com</pre>
<p>If everything went well you should see your mail <code>status=sent</code> in your maillog usually located in <code>/var/log/maillog</code></p>
<pre>Jul 30 22:44:32 mwiapp01 postfix/smtp[19253]: 60DAF4078131: 
to=&lt;someemail@gmail.com&gt;, 
relay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25, 
delay=7.2, delays=0.05/0.03/4/3.1, dsn=2.6.0, 
status=sent (250 2.6.0 &lt;5f234d49.DY75T7s4TYaD7ECn%username@gritfy.com&gt; 
[InternalId=23136988825661, Hostname=MA1PR01MB3468.INDPRD01.PROD.OUTLOOK.COM] 8682 bytes in 0.311, 27.186 KB/sec Queued mail for delivery)
Jul 30 22:44:32 mwiapp01 postfix/qmgr[3774]: 60DAF4078131: removed</pre>
<p>&nbsp;</p>
<h2><span style="color: #003366;">Multiple Domains and <span style="color: #e31974;">Sender Based Relay</span> PostFIX  Office365</span></h2>
<p>You can have more than one relays in Postfix and configure postfix to choose the relay configuration and credentials based on the sender email ID</p>
<p>For example, If you want to send emails from two different users on the same domain you can do that</p>
<pre>username1@gritfy.com
username2@gritfy.com</pre>
<p>or if you want to send emails from two different domains and email IDs you can do that too with postfix</p>
<pre>username@gritfy.com
username@middlwareinventory.com</pre>
<p>&nbsp;</p>
<p>So How to achieve sender based SMTP relay in postfix</p>
<p>If you are trying to use two different Office365 accounts you need to do all the same steps we did earlier, Since this post is about Office365 and postfix let me presume that the other account hosted by Office365 too.</p>
<p>So you need to redo these steps on the other Email Domain as well. in my case it is <code>middlewareinventory.com</code> as I have already done these steps for <code>grify.com</code></p>
<ol>
<li>Create a Connector in Corresponding Office365 and allow the IP of your Server</li>
<li>Whitelist your IP in Exchange Connection Filter</li>
<li>Update your SPF record and add your Server IP where your Postfix is running</li>
</ol>
<p>I presume that you have done these steps flawlessly Let us skip to the postfix configuration section</p>
<h3>Update the main.cf configuration of Postfix to Support Sender based relay</h3>
<p>If you are following along from the Single SMTP relay and to this multiple smtp relay you need to update few values, If you are directly setting up sender based relay you can just copy and paste these values in your <code>/etc/postfix/main.cf</code> file at the bottom</p>
<pre>smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd_maps
smtp_sasl_security_options = noanonymous
smtp_tls_security_level = may
header_size_limit = 4096000
inet_protocols = all
smtp_sender_dependent_authentication = yes
sender_dependent_relayhost_maps = hash:/etc/postfix/relay_by_sender</pre>
<p>If you look at the configuration there are two files (maps) we need to create and place it on the server. First, let us create the <code>/etc/postfix/relay_by_sender</code> file which is needed for the sender dependent relay in Postfix</p>
<h3>Create a relay_by_sender file for Postfix and Keep the Mail Server (MX) details</h3>
<p>Within the <code>relay_by_sender</code> file we need to paste the following content. Make sure you update these values with your mail server smart host (mail server) details.</p>
<pre>username@gritfy.com [gritfy-com.mail.protection.outlook.com]:25
username@devopsjunction.com [devopsjunction.mail.protection.outlook.com]:25</pre>
<p>Once you have saved the file in <code>/etc/postfix/relay_by_sender</code> now you need to create a DB file for postfix to use it. using the postmap command</p>
<pre>postmap /etc/postfix/relay_by_sender</pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3>Create the Sasl_Passwd_maps file with relays and credentials</h3>
<p>Now we need to provide credentials for both of these relays we have created. so create a file under <code>/etc/postfix</code> with the name <code>sasl_passwd_maps</code></p>
<pre>[gritfy-com.mail.protection.outlook.com]:25 username@gritfy.com:MysecretPassword
[devopsjunction.mail.protection.outlook.com]:25 username@devopsjunction.com:Password</pre>
<p>and just like you did earlier you have to create the db file using postmap</p>
<pre>postmap /etc/postfix/sasl_passwd_maps</pre>
<p>&nbsp;</p>
<h3>Reload or the Restart the Postfix server and test the relays</h3>
<p>Now you have made necessary changes for your sender based relays to work. So go ahead and restart/reload your postfix server</p>
<pre>service postfix reload(or)
service postfix restart</pre>
<p>Send some test emails to validate if the mails are passing through the right relays</p>
<p>To test the first sender with gritfy.com. Mention the sender address with <code>-r</code> while sending your email.</p>
<pre>echo "Some Email to Test"|mailx -s "Test Email" -r username@gritfy.com someone@somecompany.com</pre>
<p>To test the second sender with devopsjunction.com, update the sender address after <code>-r</code> and hit it</p>
<pre>echo "Some Email to Test"|mailx -s "Test Email" -r username@devopsjunction.com someone@somecompany.com</pre>
<p>to know which relay the email is going through and to see if it has been sent to the recipient or not. use the maillog usually located at <code>/var/log/maillog</code></p>
<pre>Jul 31 00:58:35 mwiapp01 postfix/smtp[26151]: 28D5A4078131: 
to=&lt;someone@somecompany.com&gt;, 
<span style="color: #993300;">relay=gritfy-com.mail.protection.outlook.com[104.47.100.36]:25</span>, 
delay=7.8, delays=0.06/0.05/4.2/3.5, dsn=2.6.0, 
<span style="color: #993300;">status=sent</span> (250 2.6.0 &lt;5f236cb4.kaTYiINfdbNN2Gyr%username@gritfy.com&gt; [InternalId=22905060593379, Hostname=MAXPR01MB4031.INDPRD01.PROD.OUTLOOK.COM] 8684 bytes in 0.610, 13.883 KB/sec Queued mail for delivery)
Jul 31 00:58:35 mwiapp01 postfix/qmgr[25474]: 28D5A4078131: removed</pre>
<p>So we have successfully testing Single and Multiple Sender Relay with Office365 and Postfix</p>
<p>Now I want to give a few links for you to help you with your SMTP relay troubleshooting and to fix your setup issues.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2><span style="color: #003366;"><span style="color: #e31974;">Troubleshooting</span> SMTP relay issues</span></h2>
<p>There are few errors I have faced during the implementation of this setup and I found some articles on the internet to help me. I am listing them here for your reference.</p>
<p>This type of SMTP relay is little complex but highly customizable and programmable and since you are connecting directly to MX server or Smart Host of Office365. There are lot of restrictions to identify and to ensure that you are not a Spammer.</p>
<p>Like IP restrictions and blocks etc and the other issue could be SPF and IP whitelisting. So make sure you do everything discussed in this post without missing still if you are having issues, here are few links I can refer to you</p>
<ol>
<li> <a href="https://docs.microsoft.com/en-us/exchange/mail-flow-best-practices/fix-issues-with-printers-scanners-and-lob-applications-that-send-email-using-off">Microsoft article on Troubleshooting the SMTP relay</a></li>
<li> <a href="https://bobcares.com/blog/office-365-relay-access-denied-error/">Five possible root causes for Relay access denied and how to fix it</a></li>
<li> <a href="https://mxtoolbox.com/blacklists.aspx">IP blacklist checker and Email Delivery Problem finder</a></li>
</ol>
<p>&nbsp;</p>
<h2>Testing the Score of your SMTP setup or Spam Test Result</h2>
<p>I highly recommend testing your SMTP setup by sending email to the dynamic email ID generated by <a href="https://www.mail-tester.com/">https://www.mail-tester.com/</a></p>
<p>Visit the web page and copy the dynamic email ID shown on the screen and once the email is sent. Check your score. It would list out your configuration issues and Spammyness of your email with possible fixes</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM.png"><img class="alignnone size-full wp-image-5606" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM.png" alt="Postfix Office365 relay" width="2322" height="1960" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM.png 2322w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM-300x253.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM-768x648.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-31-at-10.44.03-AM-1024x864.png 1024w" sizes="(max-width: 2322px) 100vw, 2322px" /></a></p>
<p>&nbsp;</p>
<p>I have prepared this article in a hope that it serves as a Single page of reference when you want to set up Postfix Office365 SMTP relay and troubleshoot it.  Hope it helps.</p>
<p>Ask me questions using comments</p>
<p>Cheers<br />
Sarav AK (சரவணன் அ க)</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/postfix-relay-office-365/">Postfix SMTP relay to Office 365 &#8211; Single and Multiple SMTP Servers</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Traefik Docker Example and Introduction</title>
		<link>https://www.middlewareinventory.com/blog/traefik-docker/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=traefik-docker</link>
		<pubDate>Sun, 05 Jul 2020 09:57:29 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Traefik]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5472</guid>
		<description><![CDATA[<p>Traefik Loadbalancer is growing in the container and microservices industry as a leader in Loadbalancing, Routing and service management.  It has everything that typical load balancers like haproxy provides and a few cooler and advanced features like Auto Service detections and LetsEncrypt SSL integration and SNI support etc. Here is[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/traefik-docker/">Traefik Docker Example and Introduction</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>Traefik Loadbalancer is growing in the container and microservices industry as a leader in Loadbalancing, Routing and service management.  It has everything that typical load balancers like haproxy provides and a few cooler and advanced features like Auto Service detections and LetsEncrypt SSL integration and SNI support etc.</p>
<p>Here is the quick diagram that explains what is traefik and what it can do for you.</p>
<p>&nbsp;</p>
<figure id="attachment_5474" style="width: 2875px" class="wp-caption alignnone"><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture.png"><img class="wp-image-5474 size-full" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture.png" alt="" width="2875" height="1501" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture.png 2875w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture-300x157.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture-768x401.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/traefik-architecture-1024x535.png 1024w" sizes="(max-width: 2875px) 100vw, 2875px" /></a><figcaption class="wp-caption-text">Image Credits to Traefik</figcaption></figure>
<p>&nbsp;</p>
<p>Here is the list of few important features that make traefik standout in the market</p>
<ol>
<li>Traefik is natively compliant with every major cluster technology, such as Kubernetes, Docker, Docker Swarm, AWS, Mesos, Marathon, and <a href="https://docs.traefik.io/providers/overview/">the list goes on</a>;</li>
<li>There is no need to maintain and synchronize a separate configuration file: everything happens automatically, in real-time (<strong>no restarts</strong>, no connection interruptions).</li>
<li>Designed for modern infrastructure, Micro Services in mind.</li>
<li><strong>Innovative Web User Interface</strong> than any of its competitor products in the market.</li>
<li>Built-in <strong>LetsEncrypt</strong> SSL Certificate provisioning is another major key factor</li>
<li><strong>Auto Services Discovery</strong> &#8211; When you add a new docker service, without any modification Traefik would reconfigure itself and your services would be ready to be used.</li>
<li>TCP Support with <strong>SNI Routing</strong> &amp; Multi-Protocol Support HTTP &amp; TLS</li>
<li>Canary Deployments and A/B testing &#8211; Know more about<a href="https://dev.to/mostlyjason/intro-to-deployment-strategies-blue-green-canary-and-more-3a3"> types of deployment</a> in DevOps</li>
<li>More Customization in terms of Routing and Redirection policies with various middleware products and services. <a href="https://containo.us/blog/traefik-2-0-6531ec5196c2/" target="_blank" rel="noopener">Refer this article for more</a></li>
</ol>
<p>&nbsp;</p>
<p>Here is a quick look of the Traefik Web UI.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik.png"><img class="alignnone size-full wp-image-5482" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik.png" alt="" width="1911" height="1585" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik.png 1911w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik-300x249.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik-768x637.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/traefik-1024x849.png 1024w" sizes="(max-width: 1911px) 100vw, 1911px" /></a></p>
<p>&nbsp;</p>
<h3><span style="font-size: 18pt;">Traefik Docker Testing with Docker Desktop CE<br />
</span></h3>
<p>The Best way to learn something is to try it out. that&#8217;s what we are going to do in this article. We are going to deploy Traefik Docker image in locally ( mac ) running Docker CE</p>
<p>I presume that you have a Docker CE installed and you have some basic idea on how to deploy docker image as a container</p>
<p><span style="color: #0b4c7d;">This article would help you get started with Docker if you are new to Docker and Containers</span></p>
<blockquote class="wp-embedded-content" data-secret="CR6I7mkiGx"><p><a href="https://www.middlewareinventory.com/blog/docker-run-image-as-container/">Docker Run Image as Container &#8211; Create Container From Docker Image</a></p></blockquote>
<p><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" src="https://www.middlewareinventory.com/blog/docker-run-image-as-container/embed/#?secret=CR6I7mkiGx" data-secret="CR6I7mkiGx" width="600" height="338" title="&#8220;Docker Run Image as Container &#8211; Create Container From Docker Image&#8221; &#8212; Middleware Inventory" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<p>&nbsp;</p>
<h3><span style="font-size: 18pt;">Onward to Creating few Containers in Docker before setting up Traefik</span></h3>
<p>Before testing the Traefik Loadbalancer we need to have few applications to test it with. Without any backend how can we test the load balancer any way?</p>
<p>If you have a container of that sort then you can skip this step, otherwise buckle up</p>
<p>For this post, I am taking an <a href="https://hub.docker.com/_/nginx">Nginx Docker</a> image and going to set up two static websites with HTML files</p>
<p>&nbsp;</p>
<h3><span style="font-size: 14pt;"><span style="font-size: 18pt;">Creating workspace and HTML files</span> </span></h3>
<p>Let&#8217;s call these applications <code>webapp1</code> and <code>webapp2</code></p>
<p>So Now we need to create two static HTML pages for our web applications.</p>
<p>Choose some directory in your local file system and create two directories named <code>webapp1</code> and <code>webapp2</code> beneath the same. In my case, /apps/docker is my  workspace in which am going to create</p>
<p>Given below is the Tree Structure of entire workspace and I have created two <code>index.html</code> files inside my webapp directories</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace.png"><img class="alignnone size-full wp-image-5487" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace.png" alt="" width="1464" height="640" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace.png 1464w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace-300x131.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace-768x336.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/TraefikDockerWorkSpace-1024x448.png 1024w" sizes="(max-width: 1464px) 100vw, 1464px" /></a></p>
<p>Here is the file content for the <code>webapp1/index.html</code></p>
<pre>&lt;h2&gt; this is &lt;b style="color: crimson"&gt; WebApp1 &lt;/b&gt;&lt;/h2&gt;</pre>
<p>Here is the file content for the <code>webapp2/index.html</code></p>
<pre>h2&gt; this is &lt;b style="color: crimson"&gt; WebApp2 &lt;/b&gt;&lt;/h2&gt;</pre>
<p>If you test this file locally in your browser the output would look something like this</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik.png"><img class="alignnone wp-image-5488 size-medium" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik-300x131.png" alt="" width="300" height="131" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik-300x131.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik-768x334.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik-1024x446.png 1024w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/testapps-traefik.png 1222w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3><span style="font-size: 18pt;">Launch our web applications with NGINX Container</span><span style="font-size: 18pt; color: #003366;"><br />
</span></h3>
<p>It is a time now to start our NGINX Containers with our customized <code>index.html</code> files.  We are going to share the <code>/apps/docker/webapp1</code> and <code>/apps/docker/webapp2</code> as a Shared volume to the containers, we are creating.</p>
<p>here is the command to launch our containers with Shared Volumes</p>
<p>webapp1</p>
<pre>docker run --name webapp1 -v <strong>/apps/docker/webapp1</strong>:/usr/share/nginx/html:ro -d nginx</pre>
<p>webapp2</p>
<pre>docker run --name webapp2 -v <strong>/apps/docker/webapp2</strong>:/usr/share/nginx/html:ro -d nginx</pre>
<p>You can see that we are sharing the directories to the containers and it would be mounted as <code>/usr/share/nginx/html</code> inside the container where NGINX default document root is pointed to.</p>
<p>So when the NGINX comes up inside the container we would be able to access our Application.</p>
<blockquote><p> For Mac Users:</p>
<p>You have to share these directories using the Docker File Sharing option available in   your Docker Desktop Preferences.</p>
<p><code> Docker -&gt; Preferences... -&gt; File Sharing.</code></p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/DockerSharing.png"><img class="alignnone wp-image-5495 size-medium" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/DockerSharing-300x176.png" alt="" width="300" height="176" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/DockerSharing-300x176.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/DockerSharing-768x450.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/DockerSharing-1024x601.png 1024w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>
<p>Once you have shared the FileSystem, you have to restart your DockerCE for the changes to take effect.</p></blockquote>
<p>&nbsp;</p>
<p>Note that we have not done any port forwarding to local. so technically the webapp1 and webapp2 should not be accessible from the host (mac/windows).</p>
<p>Because we are going to use traefik to handle all our incoming calls efficiently and with the power of Traefik, we achieve any level of routing and load balancing.</p>
<p>With no further ado, let us start <code>traefik</code></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3><span style="font-size: 18pt;">Launch the Traefik Container</span></h3>
<p>Traefik comes with a lot of features and capabilities as mentioned earlier. But for a starter, let us start with having a Simple Host-based routing with Traefik</p>
<p>Before launching the traefik, Let us create a configuration file with the default rule for Traefik to start doing its magic.</p>
<p>Here is the basic level traefik configuration file with host-based routing enabled to all other containers running on the local. It would auto-detect our webapp1 and webapp2 and would also detect any container that we might start in the future</p>
<p>In Kubernetes, this same configuration auto-detection and forwarding is  known as <code>Ingress Controller</code></p>
<pre>## traefik.yml

# Docker configuration backend
providers:
  docker:
    defaultRule: "Host(`{{ trimPrefix `/` .Name }}.dev.local`)"

# API and dashboard configuration
api:
  insecure: true</pre>
<p>Save this file as <code>traefik.yml</code> and run the following docker command to start our beloved traefik</p>
<pre>docker run -d -p 8080:8080 -p 80:80 \
-v $PWD/traefik.yml:/etc/traefik/traefik.yml \
-v /var/run/docker.sock:/var/run/docker.sock --name traefik \
traefik:v2.0</pre>
<p>If you look at the preceding <code>docker run</code> command closely you would see that we are sharing the <code>docker.sock</code> file with traefik container along with the configuration file named <code>traefik.yml</code></p>
<p>this file serves as a repository and configuration for docker and docker runtime containers. this is how traefik is able to auto-detect the containers. to know more about <code>docker.sock</code> file <a href="https://medium.com/better-programming/about-var-run-docker-sock-3bfd276e12fd">refer this post</a></p>
<p>I have two nginx containers and traefik running for now so technically traefik would be able to detect all these containers.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM.png"><img class="alignnone size-full wp-image-5497" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM.png" alt="" width="3226" height="240" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM.png 3226w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM-300x22.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM-768x57.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.29.41-PM-1024x76.png 1024w" sizes="(max-width: 3226px) 100vw, 3226px" /></a></p>
<p>If you have tools like <code>dnsmasq</code> installed in your Mac/Windows you can easily achieve the wildcard based domain name like <code>*.dev.local to 127.0.0.1</code> like that</p>
<p>Otherwise, let us use our default option of editing the <code>/etc/hosts</code> file and add the below entries</p>
<pre>127.0.0.1 webapp2.dev.local
127.0.0.1 webapp1.dev.local</pre>
<p>That&#8217;s all.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3><span style="font-size: 18pt;">Testing the Setup</span></h3>
<p>If you have done everything right. You should be able to access your application using <code>webapp1.dev.local</code> and <code>webapp2.dev.local</code></p>
<blockquote><p> <strong>How this names are taken ? webapp1 and webapp2</strong></p>
<p>webapp1 and webapp2 are the container names we have given with <code>--name</code> parameter while starting our container.  If you have given someother name while starting the container this would not work.</p></blockquote>
<p>Also, you can reach the beautiful frontend of Traefik using <code>http://localhost:8080</code> URL, as you have forwarded this port 8080 when you were launching the container</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM.png"><img class="alignnone size-full wp-image-5500" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM.png" alt="Docker Traefik Example" width="3158" height="1512" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM.png 3158w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM-300x144.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM-768x368.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.15-PM-1024x490.png 1024w" sizes="(max-width: 3158px) 100vw, 3158px" /></a></p>
<p>If you click on the <code>HTTP</code> tab on the WEB UI you can view the services listed</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM.png"><img class="alignnone size-full wp-image-5501" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM.png" alt="Docker Traefik" width="3210" height="1102" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM.png 3210w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM-300x103.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM-768x264.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-1.40.27-PM-1024x352.png 1024w" sizes="(max-width: 3210px) 100vw, 3210px" /></a></p>
<p>Now we can test the application in our browser and in my side results were good as expected.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM.png"><img class="alignnone size-full wp-image-5503" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM.png" alt="Docker Traefik" width="1430" height="546" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM.png 1430w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM-300x115.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM-768x293.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.37.21-PM-1024x391.png 1024w" sizes="(max-width: 1430px) 100vw, 1430px" /></a></p>
<p>&nbsp;</p>
<p><strong><span style="font-size: 18pt;">Test with CURL host header field</span> </strong></p>
<p>For some reason, you don&#8217;t want to update the <code>/etc/hosts</code> file and still want to test this setup. You can use the <code>CURL</code> command with the host header field to achieve the same result.</p>
<p>WebServers and Proxy Servers like traefik gets its name from the <code>host</code> header field so if you are customizing the host header and send a request to your <code>localhost:80</code> you would be able to reach the site you have intended to reach</p>
<p>to reach webapp1</p>
<pre>curl --header "host:webapp1.dev.local" localhost:80</pre>
<p>to reach webapp2</p>
<pre>curl --header "host:webapp2.dev.local" localhost:80</pre>
<p>You can see that we are actually making a call to the <code>http://localhost</code> here but we are able to reach our applications, this is host-based virtual hosting is achieved</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM.png"><img class="alignnone size-full wp-image-5502" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM.png" alt="Docker Traefik" width="1700" height="342" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM.png 1700w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM-300x60.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM-768x155.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.29.56-PM-1024x206.png 1024w" sizes="(max-width: 1700px) 100vw, 1700px" /></a></p>
<p>&nbsp;</p>
<h3><span style="font-size: 18pt;">Testing the Auto Detection of Traefik</span></h3>
<p>Now we should test if traefik is auto-detecting if we are launching a new container in our system. This time let us take another tomcat application container image from docker hub.</p>
<p>Go to the terminal or command line and launch a new container and name the container as <code>tomcat</code> according to our rule, traefik should auto-detect this container and make it available at <code>tomcat.dev.local</code></p>
<pre>docker run -d --name tomcat saravak/tomcat8</pre>
<p>without any hostname update you are ready to test this with curl</p>
<pre>➜ ~ <strong>curl --header "host:tomcat.dev.local" localhost/SampleWebApp/</strong>
&lt;!DOCTYPE html&gt;
&lt;!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
--&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;SampleWebApp&lt;/title&gt;
&lt;meta charset="UTF-8"&gt;
&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;Sample Web Application To Deploy and Test&lt;/h2&gt;
&lt;br&gt;
&lt;div&gt; click &lt;a href="SnoopServlet"&gt;Click to Invoke a SnoopServlet&lt;/a&gt;&lt;/div&gt;
&lt;br&gt;
&lt;br&gt;


&lt;/body&gt;
&lt;/html&gt;</pre>
<p>Or you can update the <code>/etc/hosts</code> file and add an entry like this</p>
<pre>127.0.0.1 tomcat.dev.local</pre>
<p>this is my sample Tomcat based Application which would reveal some useful information including the container hostname and the ip address, this would match with your <code>docker ps</code> results.</p>
<p>&nbsp;</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM.png"><img class="alignnone size-full wp-image-5504" src="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM.png" alt="" width="1726" height="1834" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM.png 1726w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM-282x300.png 282w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM-768x816.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/07/Screenshot-2020-07-05-at-2.54.25-PM-964x1024.png 964w" sizes="(max-width: 1726px) 100vw, 1726px" /></a></p>
<p>&nbsp;</p>
<p>This is how the Auto-detection feature of traefik works. Mission accomplished. Henceforth without having to open multiple ports and port forwardings. You can keep launching the containers and traefik would take care of the rest for you.</p>
<p>I think this is enough for the introduction article, In my next article, we will cover more about other rules and options available with Traefik including SSL.</p>
<p>Until then. Stay Safe, Stay Connected.!</p>
<p>Cheers<br />
SaravAK</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/traefik-docker/">Traefik Docker Example and Introduction</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Docker VueJS Example</title>
		<link>https://www.middlewareinventory.com/blog/docker-vuejs/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=docker-vuejs</link>
		<pubDate>Tue, 16 Jun 2020 16:53:31 +0000</pubDate>
		<dc:creator><![CDATA[Hanumanth]]></dc:creator>
				<category><![CDATA[Docker]]></category>
		<category><![CDATA[JavaScript]]></category>
		<category><![CDATA[NodeJS]]></category>
		<category><![CDATA[VueJS]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5412</guid>
		<description><![CDATA[<p>In this post, we are going to see how to Create a simple VueJS Web Application, Deploy the VueJS web application to Docker, How to create Docker Images and start the container from the images, How to manage the docker container and How to deploy the VueJS Application in production[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/docker-vuejs/">Docker VueJS Example</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>In this post, we are going to see how to Create a simple VueJS Web Application, Deploy the VueJS web application to Docker, How to create Docker Images and start the container from the images, How to manage the docker container and How to deploy the VueJS Application in production using NGINX etc.</p>
<p>Docker VueJS Web Application Example is the objective of this post.</p>
<p>VueJS is an open-source <strong>progressive JavaScript framework</strong> for building user interfaces and single-page applications.</p>
<p>Docker is a container management system, It helps us to create, manage and administrate containers in an easy and efficient way.</p>
<p>Shortly put, This post is all about Dockerising VueJS.</p>
<p>Want to know more about what is container and containerisation, <a href="https://www.middlewareinventory.com/blog/what-is-container-and-containerization-a-basic-notes/">Refer this link</a></p>
<p>&nbsp;</p>
<h2>The Index</h2>
<p>This is the summary of topics we are going to see in this article.</p>
<ol>
<li>What are we going to build &#8211; Docker VueJS Web Application</li>
<li>Installing Docker, NodeJS &amp; Vue CLI</li>
<li>VueJS Web Application Setup
<ol>
<li>Creating VueJS Project</li>
<li>Updating the initial page of our project (optional)</li>
</ol>
</li>
<li>Test our Web Application Locally Before Packaging it as Container.</li>
<li>Docker Configuration and Setup
<ol>
<li>Create a Dockerfile</li>
<li>Build a Docker Vue JS Image using Dockerfile</li>
<li>Start the Container from the Image we have created</li>
<li>Validate the web application Running inside Container</li>
</ol>
</li>
<li>Securing Vue JS Application using NGINX (Optional)
<ol>
<li>Create a Dockerfile</li>
<li>Build a Docker Vue JS Image using Dockerfile</li>
<li>Start the Container from the Image we have created</li>
<li>Validate the web application Running inside Container</li>
</ol>
</li>
</ol>
<p>&nbsp;</p>
<h2>What are we going to build &#8211; Docker VueJS Web Application</h2>
<p>Before proceeding to the steps of creating and development of Vue JS web Application and Docker Image. Let us see how is our desired result is going to be</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png"><img class="alignnone size-full wp-image-5438" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png" alt="" width="3584" height="1282" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png 3584w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-300x107.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-768x275.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-1024x366.png 1024w" sizes="(max-width: 3584px) 100vw, 3584px" /></a></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2>Installing Docker, NodeJS &amp; Vue CLI</h2>
<p>In order to follow this article, It&#8217;s good to have the following environment set at your host machine.</p>
<p>Note*: This is not inside the container. This is a Host machine ( Local Environment) where you have Docker installed (or) going to install.</p>
<p><strong>Machine:</strong> Mac/Windows</p>
<p><strong>Docker Installation:</strong> Docker CE</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜  docker version
<span class="hljs-attribute" style="color: #f0c674;">Client</span>: Docker Engine - Community
 <span class="hljs-attribute" style="color: #f0c674;">Version</span>:           <span class="hljs-number" style="color: #de935f;">19.03</span>.<span class="hljs-number" style="color: #de935f;">8</span>
 API <span class="hljs-attribute" style="color: #f0c674;">version</span>:       <span class="hljs-number" style="color: #de935f;">1.40</span>
 Go <span class="hljs-attribute" style="color: #f0c674;">version</span>:        go1.<span class="hljs-number" style="color: #de935f;">12.17</span>
 Git <span class="hljs-attribute" style="color: #f0c674;">commit</span>:        afacb8b
 <span class="hljs-attribute" style="color: #f0c674;">Built</span>:             Wed Mar <span class="hljs-number" style="color: #de935f;">11</span> <span class="hljs-number" style="color: #de935f;">01</span>:<span class="hljs-number" style="color: #de935f;">21</span>:<span class="hljs-number" style="color: #de935f;">11</span> <span class="hljs-number" style="color: #de935f;">2020</span>
 OS/<span class="hljs-attribute" style="color: #f0c674;">Arch</span>:           darwin/amd64
 <span class="hljs-attribute" style="color: #f0c674;">Experimental</span>:      true

<span class="hljs-attribute" style="color: #f0c674;">Server</span>: Docker Engine - Community
 <span class="hljs-attribute" style="color: #f0c674;">Engine</span>:
  <span class="hljs-attribute" style="color: #f0c674;">Version</span>:          <span class="hljs-number" style="color: #de935f;">19.03</span>.<span class="hljs-number" style="color: #de935f;">8</span>
  API <span class="hljs-attribute" style="color: #f0c674;">version</span>:      <span class="hljs-number" style="color: #de935f;">1.40</span> (minimum version <span class="hljs-number" style="color: #de935f;">1.12</span>)
  Go <span class="hljs-attribute" style="color: #f0c674;">version</span>:       go1.<span class="hljs-number" style="color: #de935f;">12.17</span>
  Git <span class="hljs-attribute" style="color: #f0c674;">commit</span>:       afacb8b
  <span class="hljs-attribute" style="color: #f0c674;">Built</span>:            Wed Mar <span class="hljs-number" style="color: #de935f;">11</span> <span class="hljs-number" style="color: #de935f;">01</span>:<span class="hljs-number" style="color: #de935f;">29</span>:<span class="hljs-number" style="color: #de935f;">16</span> <span class="hljs-number" style="color: #de935f;">2020</span>
  OS/<span class="hljs-attribute" style="color: #f0c674;">Arch</span>:          linux/amd64
  <span class="hljs-attribute" style="color: #f0c674;">Experimental</span>:     true</pre>
<p><strong>Package Manager: </strong>NPM</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜ <span class="hljs-selector-tag" style="color: #b294bb;">npm</span> <span class="hljs-selector-tag" style="color: #b294bb;">version</span>
{<span class="hljs-attribute" style="color: #f0c674;">npm</span>: <span class="hljs-string" style="color: #b5bd68;">'6.14.5'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">ares</span>: <span class="hljs-string" style="color: #b5bd68;">'1.15.0'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">brotli</span>: <span class="hljs-string" style="color: #b5bd68;">'1.0.7'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">cldr</span>: <span class="hljs-string" style="color: #b5bd68;">'35.1'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">http_parser</span>: <span class="hljs-string" style="color: #b5bd68;">'2.9.3'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">icu</span>: <span class="hljs-string" style="color: #b5bd68;">'64.2'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">llhttp</span>: <span class="hljs-string" style="color: #b5bd68;">'2.0.4'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">modules</span>: <span class="hljs-string" style="color: #b5bd68;">'72'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">napi</span>: <span class="hljs-string" style="color: #b5bd68;">'5'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">nghttp2</span>: <span class="hljs-string" style="color: #b5bd68;">'1.40.0'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">node</span>: <span class="hljs-string" style="color: #b5bd68;">'12.16.1'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">openssl</span>: <span class="hljs-string" style="color: #b5bd68;">'1.1.1d'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">tz</span>: <span class="hljs-string" style="color: #b5bd68;">'2019c'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">unicode</span>: <span class="hljs-string" style="color: #b5bd68;">'12.1'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">uv</span>: <span class="hljs-string" style="color: #b5bd68;">'1.34.0'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">v8</span>: <span class="hljs-string" style="color: #b5bd68;">'7.8.279.23-node.31'</span>,
  <span class="hljs-attribute" style="color: #f0c674;">zlib</span>: <span class="hljs-string" style="color: #b5bd68;">'1.2.11'</span>}</pre>
<p><strong>Server Framework:</strong> NodeJS</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜ <span class="hljs-selector-tag" style="color: #b294bb;">npm</span> <span class="hljs-selector-tag" style="color: #b294bb;">--version</span>
<span class="hljs-selector-class" style="color: #cc6666;">6.14</span><span class="hljs-selector-class" style="color: #cc6666;">.5</span></pre>
<p><strong>JavaScript Framework:</strong> VueJS</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜  ~ vue --<span class="hljs-keyword" style="color: #b294bb;">version</span>
@vue/<span class="hljs-keyword" style="color: #b294bb;">cli</span> 4.4.1</pre>
<p><strong>IDE:  </strong>Visual Studio Code in my case.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2>Vue JS Web Application Setup</h2>
<p>In this segment, we are going to create a sample Vue JS specific configuration steps like how to create a Vue JS Web Application. You can exclude below steps by cloning project <a href="https://github.com/hanu-developer/docker-vuejs">from this link</a></p>
<p><code>git clone https://github.com/hanu-developer/docker-vuejs.git</code></p>
<p>&nbsp;</p>
<h3>Step 1: Creating Vue JS Project</h3>
<p>Run this below command which will initialise the project creation.</p>
<p><code>vue create docker-vuejs</code></p>
<p>You will be prompted to pick a preset. You can either choose the default preset which comes with a basic Babel + ESLint setup, or select &#8220;Manually select features&#8221; to pick the features you need.</p>
<p>In this case i select <strong>default </strong>setup because it&#8217;s great for quickly prototyping a new project, while the manual setup provides more options that are likely needed for more production-oriented projects.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55.png"><img class="alignnone size-full wp-image-5433" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55.png" alt="" width="2216" height="432" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55.png 2216w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55-300x58.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55-768x150.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.46.55-1024x200.png 1024w" sizes="(max-width: 2216px) 100vw, 2216px" /></a><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04.png"><img class="alignnone size-full wp-image-5434" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04.png" alt="" width="2230" height="282" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04.png 2230w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04-300x38.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04-768x97.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-19.48.04-1024x129.png 1024w" sizes="(max-width: 2230px) 100vw, 2230px" /></a></p>
<p>&nbsp;</p>
<h3>Step 2: Updating initial page of your Project (Optional)</h3>
<p>Update your <strong>HelloWorld.vue</strong> as below</p>
<div>
<pre class="hljs" style="padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="xml"><span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">template</span>&gt;</span>
  <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">div</span> <span class="hljs-attr" style="color: teal;">class</span>=<span class="hljs-string" style="color: #dd1144;">"hello"</span>&gt;</span>
    <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">div</span> <span class="hljs-attr" style="color: teal;">style</span>=<span class="hljs-string" style="color: #dd1144;">"padding:40px;"</span>&gt;</span>
      <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">h1</span>&gt;</span>
        Hello from
        <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">span</span> <span class="hljs-attr" style="color: teal;">style</span>=<span class="hljs-string" style="color: #dd1144;">"color:#29558C"</span>&gt;</span>Middleware[i<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">span</span>&gt;</span>
        <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">span</span> <span class="hljs-attr" style="color: teal;">style</span>=<span class="hljs-string" style="color: #dd1144;">"color:#AD5353"</span>&gt;</span>]nventory<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">span</span>&gt;</span>
      <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">h1</span>&gt;</span>
      <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">p</span>&gt;</span>
        It is good to have you here this is a Simple Page in
        <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">span</span> <span class="hljs-attr" style="color: teal;">class</span>=<span class="hljs-string" style="color: #dd1144;">"bg-info"</span>&gt;</span>Vue JS<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">span</span>&gt;</span> and Running on
        <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">span</span> <span class="hljs-attr" style="color: teal;">class</span>=<span class="hljs-string" style="color: #dd1144;">"bg-success"</span>&gt;</span>Docker Container<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">span</span>&gt;</span>
      <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">p</span>&gt;</span>
    <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">div</span>&gt;</span>
  <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">div</span>&gt;</span>
<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">template</span>&gt;</span>
<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">export</span> <span class="hljs-keyword" style="color: #333333; font-weight: bold;">default</span> {
  name: <span class="hljs-string" style="color: #dd1144;">"HelloWorld"</span>,
  props: {
    msg: <span class="hljs-built_in" style="color: #0086b3;">String</span>
  }
};
</span><span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">script</span>&gt;</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;">&lt;!-- Add "scoped" attribute to limit CSS to this component only --&gt;</span>
<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">style</span> <span class="hljs-attr" style="color: teal;">scoped</span>&gt;</span>
<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">style</span>&gt;</span></span></pre>
<div>Update your <strong>App.vue</strong> as below</div>
</div>
<pre class="hljs" style="padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="xml"><span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">template</span>&gt;</span>
  <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">div</span> <span class="hljs-attr" style="color: teal;">id</span>=<span class="hljs-string" style="color: #dd1144;">"app"</span>&gt;</span>
    <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">HelloWorld</span> /&gt;</span>
  <span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">div</span>&gt;</span>
<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">template</span>&gt;</span>

<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">import</span> HelloWorld <span class="hljs-keyword" style="color: #333333; font-weight: bold;">from</span> <span class="hljs-string" style="color: #dd1144;">"./components/HelloWorld.vue"</span>;

<span class="hljs-keyword" style="color: #333333; font-weight: bold;">export</span> <span class="hljs-keyword" style="color: #333333; font-weight: bold;">default</span> {
  name: <span class="hljs-string" style="color: #dd1144;">"App"</span>,
  components: {
    HelloWorld
  }
};
</span><span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">script</span>&gt;</span>

<span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;<span class="hljs-name" style="color: navy; font-weight: 400;">style</span>&gt;</span><span class="css">
<span class="hljs-selector-id" style="color: #990000; font-weight: bold;">#app</span> {
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">font-family</span>: Avenir, Helvetica, Arial, sans-serif;
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">-webkit-font-smoothing</span>: antialiased;
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">-moz-osx-font-smoothing</span>: grayscale;
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">text-align</span>: center;
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">color</span>: <span class="hljs-number" style="color: teal;">#2c3e50</span>;
  <span class="hljs-attribute" style="color: navy; font-weight: 400;">margin-top</span>: <span class="hljs-number" style="color: teal;">60px</span>;
}
</span><span class="hljs-tag" style="color: navy; font-weight: 400;">&lt;/<span class="hljs-name" style="color: navy; font-weight: 400;">style</span>&gt;</span></span></pre>
<p>&nbsp;</p>
<h2>Test Our Web Application Locally Before Packaging it as Container</h2>
<p>By executing below command npm will facilitate our web application to run locally.</p>
<p><code>npm run serve</code></p>
<p>Now go to your browser and access http://localhost:8080 and make sure you see something like this</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png"><img class="alignnone size-full wp-image-5438" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png" alt="" width="3584" height="1282" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18.png 3584w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-300x107.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-768x275.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-07-at-20.57.18-1024x366.png 1024w" sizes="(max-width: 3584px) 100vw, 3584px" /></a></p>
<p>&nbsp;</p>
<h2>Docker Configuration and Setup</h2>
<p>In this segment, we are going to containerise our application we have created.  In other words, we are going to create an image which can be used by anyone to create a container and to achieve the same result as we did.</p>
<h3>Step 1: Creating a Dockerfile</h3>
<p>This is a Simply a manifest on how your image should be created. Docker uses this manifest or configuration file to create the image.</p>
<p>In the project root directory create a new file named <strong>Dockerfile </strong>and place the following content.</p>
<pre class="hljs" style="padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="hljs-comment" style="color: #999988; font-style: italic;"># Choose the Image which has Node installed already</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">FROM</span> node:lts-alpine

<span class="hljs-comment" style="color: #999988; font-style: italic;"># install simple http server for serving static content</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">RUN</span> <span class="bash">npm install -g http-server
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># make the 'app' folder the current working directory</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">WORKDIR</span> <span class="bash">/app
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># copy both 'package.json' and 'package-lock.json' (if available)</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">COPY</span> <span class="bash">package*.json ./
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># install project dependencies</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">RUN</span> <span class="bash">npm install
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># copy project files and folders to the current working directory (i.e. 'app' folder)</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">COPY</span> <span class="bash">. .
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># build app for production with minification</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">RUN</span> <span class="bash">npm run build
</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">EXPOSE</span> <span class="hljs-number" style="color: teal;">8080</span>
CMD [ <span class="hljs-string" style="color: #dd1144;">"http-server"</span>, <span class="hljs-string" style="color: #dd1144;">"dist"</span> ]</pre>
<p>If you can read the comments in the file you can easily understand what each line is intended to do.</p>
<p>Note*: As per Docker Syntax, <strong>Dockerfile</strong> is the righteous name of Manifest file with D capital with no file extension, If you are thinking that there is a mistake. No there is Not.</p>
<p>&nbsp;</p>
<h3>Step 2: Build a Docker Vue JS Image using Dockerfile</h3>
<p>Using the <strong>Dockerfile</strong> we have created. Let us create an Image.</p>
<p>Note*: Before Creating the Image, Please be aware, <em>It is a good practice that you name your images with your docker username in a prefix, </em> It would enable you to share your work(images) with other people easily in future with the help of docker hub which we will see later in this article.</p>
<p>Having said that it is always recommended to name your images after your docker username. I am going to do the same and my docker username is <strong>hanu4u89.</strong></p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜  docker build -t hanu4u89/docker-vuejs .
Sending build context to Docker daemon  <span class="hljs-number" style="color: #de935f;">148.9</span>MB
Step <span class="hljs-number" style="color: #de935f;">1</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">FROM</span> node:lts-alpine
 <span class="hljs-comment" style="color: #969896;">---&gt; 1c342643aa5c</span>
Step <span class="hljs-number" style="color: #de935f;">2</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">RUN</span> npm install -g http-server
 <span class="hljs-comment" style="color: #969896;">---&gt; Using cache</span>
 <span class="hljs-comment" style="color: #969896;">---&gt; 4b694787bf68</span>
Step <span class="hljs-number" style="color: #de935f;">3</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">WORKDIR</span> /app
 <span class="hljs-comment" style="color: #969896;">---&gt; Using cache</span>
 <span class="hljs-comment" style="color: #969896;">---&gt; ca44474a9a31</span>
Step <span class="hljs-number" style="color: #de935f;">4</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">COPY</span> <span class="hljs-keyword" style="color: #b294bb;">package</span>*.json ./
 <span class="hljs-comment" style="color: #969896;">---&gt; 7445777e1d03</span>
Step <span class="hljs-number" style="color: #de935f;">5</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">RUN</span> npm install
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in 7b1626f81e7f</span>

added <span class="hljs-number" style="color: #de935f;">1273</span> packages from <span class="hljs-number" style="color: #de935f;">867</span> contributors <span class="hljs-keyword" style="color: #b294bb;">and</span> audited <span class="hljs-number" style="color: #de935f;">1279</span> packages <span class="hljs-keyword" style="color: #b294bb;">in</span> <span class="hljs-number" style="color: #de935f;">20.909</span>s

<span class="hljs-number" style="color: #de935f;">46</span> packages are looking <span class="hljs-keyword" style="color: #b294bb;">for</span> funding
  run `npm fund` <span class="hljs-keyword" style="color: #b294bb;">for</span> details

found <span class="hljs-number" style="color: #de935f;">0</span> vulnerabilities

Removing intermediate container <span class="hljs-number" style="color: #de935f;">7</span>b1626f81e7f
 <span class="hljs-comment" style="color: #969896;">---&gt; e00a6897748d</span>
Step <span class="hljs-number" style="color: #de935f;">6</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">COPY</span> . .
 <span class="hljs-comment" style="color: #969896;">---&gt; 20d850147946</span>
Step <span class="hljs-number" style="color: #de935f;">7</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">RUN</span> npm run build
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in b6b9a4846c06</span>

&gt; docker-vuejs@<span class="hljs-number" style="color: #de935f;">0.1</span>.<span class="hljs-number" style="color: #de935f;">0</span> build /app
&gt; vue-cli-service build

-  Building <span class="hljs-keyword" style="color: #b294bb;">for</span> production...
 DONE  Compiled successfully <span class="hljs-keyword" style="color: #b294bb;">in</span> <span class="hljs-number" style="color: #de935f;">5205</span>ms12:<span class="hljs-number" style="color: #de935f;">30</span>:<span class="hljs-number" style="color: #de935f;">10</span> AM

  File                                 Size               Gzipped
  dist/js/chunk-vendors.f0b6743d.js    <span class="hljs-number" style="color: #de935f;">89.18</span> KiB          <span class="hljs-number" style="color: #de935f;">31.93</span> KiB
  dist/js/app.b67b4f73.js              <span class="hljs-number" style="color: #de935f;">2.76</span> KiB           <span class="hljs-number" style="color: #de935f;">1.31</span> KiB
  dist/css/app.d40fc157.css            <span class="hljs-number" style="color: #de935f;">0.16</span> KiB           <span class="hljs-number" style="color: #de935f;">0.14</span> KiB

  Images <span class="hljs-keyword" style="color: #b294bb;">and</span> other types <span class="hljs-keyword" style="color: #b294bb;">of</span> assets omitted.

 DONE  Build complete. The dist directory <span class="hljs-keyword" style="color: #b294bb;">is</span> ready to be deployed.
 INFO  Check <span class="hljs-keyword" style="color: #b294bb;">out</span> deployment instructions <span class="hljs-keyword" style="color: #b294bb;">at</span> https://cli.vuejs.org/guide/deployment.html

Removing intermediate container b6b9a4846c06
 <span class="hljs-comment" style="color: #969896;">---&gt; 413a8b4aecf5</span>
Step <span class="hljs-number" style="color: #de935f;">8</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">EXPOSE</span> <span class="hljs-number" style="color: #de935f;">8080</span>
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in 62693b309f53</span>
Removing intermediate container <span class="hljs-number" style="color: #de935f;">62693</span>b309f53
 <span class="hljs-comment" style="color: #969896;">---&gt; f9f5bc9983ee</span>
Step <span class="hljs-number" style="color: #de935f;">9</span>/<span class="hljs-number" style="color: #de935f;">9</span> : <span class="hljs-type" style="color: #de935f;">CMD</span> [ <span class="hljs-string" style="color: #b5bd68;">"http-server"</span>, <span class="hljs-string" style="color: #b5bd68;">"dist"</span> ]
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in bfa51a7f512d</span>
Removing intermediate container bfa51a7f512d
 <span class="hljs-comment" style="color: #969896;">---&gt; 02bf40ad9f77</span>
Successfully built <span class="hljs-number" style="color: #de935f;">02</span>bf40ad9f77
Successfully <span class="hljs-keyword" style="color: #b294bb;">tagged</span> hanu4u89/docker-vuejs:latest</pre>
<p>In the preceding snippet, you can see we have successfully created an image and named it as <strong>hanu4u89/docker-vuejs</strong></p>
<p>The command we used to build the Image from the Dockerfile is</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">docker build -t ha<span class="hljs-symbol" style="color: #b5bd68;">nu4</span>u<span class="hljs-number" style="color: #de935f;">89</span>/docker-vuejs .</pre>
<p>Here the PERIOD/DOT at the end is intentional and it represents the current directory.  With this command issued, Docker looks for a Dockerfile in the current directory and create the image out of it</p>
<p>To validate if your image has created and to know the list of images available in your system locally. use the following command.</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;"><span class="hljs-attribute" style="color: #f0c674;">docker</span> images</pre>
<p>&nbsp;</p>
<h3>Step 3: Start the container from the image we have created</h3>
<p>The Image we have created in Step2 is ready to be started and it can now become a Fully Qualified and Operational Container.</p>
<p>The following Command would create and start the Container from the image we have created</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">docker <span class="hljs-keyword" style="color: #b294bb;">run</span> -it -p 8081:8080 -d --name docker-vuejs hanu4u89/docker-vuejs</pre>
<p>Here</p>
<p><strong>-it</strong>  –  This flag sets the container in Interactive mode and allocate a Dedicated TTY id for later SSHing.</p>
<p><strong>-d</strong> –  This flag sets the container to run in the background.</p>
<p><strong>-p 8081:8080</strong> – Port Forwarding Between Host and the Container. Right to the colon is a container and Left to the colon is Host. <em>8081 is the Host and 8080 is the container Port.</em></p>
<p><strong>&#8211;name </strong>– Once started docker daemon assigns a random string name to the container. But i recommend defining a name can be handy way to add meaning to a container.</p>
<p><strong>docker-vuejs</strong> – Name of the container we are starting ( Replacement of Container ID).</p>
<p><strong>hanu4u89/docker-vuejs</strong> – The name of the image from which we are going to create a Container.</p>
<p>&nbsp;</p>
<h3>Step 4: Validate the Web Application running inside the Container</h3>
<p>Having started the Container with Port Forwarding to the host machine on Port 8081. You should be able to access the website from the Host machine (mac/windows)  at <strong>http://localhost:8081</strong></p>
<p>If everything is done correctly,  We should be able to see our desired website which we have tested locally.</p>
<p>Yay. That’s all. It is that simple to develop a Web Application in Vue JS and running it on the Docker Container.</p>
<p>Thanks to Evolution of IT.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2>Securing Vue JS Application using NGINX</h2>
<p>Above created Docker Vue JS Web Application is powerful enough for production usage, but it&#8217;s simple and hackable enough to be used for testing, local development and learning.</p>
<p>For complex production use cases it may be wiser to use giants like NGINX or Apache. In our case we are using NGINX to serve our Vue JS Web Application because it is considered as one of the most performant and tested solutions.</p>
<p>&nbsp;</p>
<h3>Step 1: Creating a Dockerfile</h3>
<p>Let&#8217;s refactor our Dockerfile to use NGINX or Delete the old Dockerfile and create a new one.</p>
<pre class="hljs" style="padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="hljs-comment" style="color: #999988; font-style: italic;"># build stage</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">FROM</span> node:lts-alpine as build-stage
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">WORKDIR</span> <span class="bash">/app
</span><span class="hljs-keyword" style="color: #333333; font-weight: bold;">COPY</span> <span class="bash">package*.json ./
</span><span class="hljs-keyword" style="color: #333333; font-weight: bold;">RUN</span> <span class="bash">npm install
</span><span class="hljs-keyword" style="color: #333333; font-weight: bold;">COPY</span> <span class="bash">. .
</span><span class="hljs-keyword" style="color: #333333; font-weight: bold;">RUN</span> <span class="bash">npm run build
</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># production stage</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">FROM</span> nginx:stable-alpine as production-stage
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">COPY</span> <span class="bash">--from=build-stage /app/dist /usr/share/nginx/html
</span><span class="hljs-keyword" style="color: #333333; font-weight: bold;">EXPOSE</span> <span class="hljs-number" style="color: teal;">80</span>
CMD [<span class="hljs-string" style="color: #dd1144;">"nginx"</span>, <span class="hljs-string" style="color: #dd1144;">"-g"</span>, <span class="hljs-string" style="color: #dd1144;">"daemon off;"</span>]</pre>
<p>&nbsp;</p>
<h3>Step 2: Build a Docker Vue JS image using Dockerfile</h3>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">➜  docker build -t hanu4u89/docker-vuejs-nginx .
Sending build context to Docker daemon  <span class="hljs-number" style="color: #de935f;">148.9</span>MB
Step <span class="hljs-number" style="color: #de935f;">1</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">FROM</span> node:lts-alpine as build-stage
 <span class="hljs-comment" style="color: #969896;">---&gt; 1c342643aa5c</span>
Step <span class="hljs-number" style="color: #de935f;">2</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">WORKDIR</span> /app
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in 85955f5faa4a</span>
Removing intermediate container <span class="hljs-number" style="color: #de935f;">85955</span>f5faa4a
 <span class="hljs-comment" style="color: #969896;">---&gt; 597534e7f448</span>
Step <span class="hljs-number" style="color: #de935f;">3</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">COPY</span> <span class="hljs-keyword" style="color: #b294bb;">package</span>*.json ./
 <span class="hljs-comment" style="color: #969896;">---&gt; 21c8acaa8351</span>
Step <span class="hljs-number" style="color: #de935f;">4</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">RUN</span> npm install
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in c71034cdb324</span>

added <span class="hljs-number" style="color: #de935f;">1273</span> packages from <span class="hljs-number" style="color: #de935f;">867</span> contributors <span class="hljs-keyword" style="color: #b294bb;">and</span> audited <span class="hljs-number" style="color: #de935f;">1279</span> packages <span class="hljs-keyword" style="color: #b294bb;">in</span> <span class="hljs-number" style="color: #de935f;">22.383</span>s

<span class="hljs-number" style="color: #de935f;">46</span> packages are looking <span class="hljs-keyword" style="color: #b294bb;">for</span> funding
  run `npm fund` <span class="hljs-keyword" style="color: #b294bb;">for</span> details

found <span class="hljs-number" style="color: #de935f;">0</span> vulnerabilities

Removing intermediate container c71034cdb324
 <span class="hljs-comment" style="color: #969896;">---&gt; 115c03b5f8be</span>
Step <span class="hljs-number" style="color: #de935f;">5</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">COPY</span> . .
 <span class="hljs-comment" style="color: #969896;">---&gt; e3d3f3ba66da</span>
Step <span class="hljs-number" style="color: #de935f;">6</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">RUN</span> npm run build
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in df514c99701b</span>

&gt; docker-vuejs@<span class="hljs-number" style="color: #de935f;">0.1</span>.<span class="hljs-number" style="color: #de935f;">0</span> build /app
&gt; vue-cli-service build

-  Building <span class="hljs-keyword" style="color: #b294bb;">for</span> production...
 DONE  Compiled successfully <span class="hljs-keyword" style="color: #b294bb;">in</span> <span class="hljs-number" style="color: #de935f;">5261</span>ms1:<span class="hljs-number" style="color: #de935f;">17</span>:<span class="hljs-number" style="color: #de935f;">05</span> AM

  File                                 Size               Gzipped
  dist/js/chunk-vendors.f0b6743d.js    <span class="hljs-number" style="color: #de935f;">89.18</span> KiB          <span class="hljs-number" style="color: #de935f;">31.93</span> KiB
  dist/js/app.b67b4f73.js              <span class="hljs-number" style="color: #de935f;">2.76</span> KiB           <span class="hljs-number" style="color: #de935f;">1.31</span> KiB
  dist/css/app.d40fc157.css            <span class="hljs-number" style="color: #de935f;">0.16</span> KiB           <span class="hljs-number" style="color: #de935f;">0.14</span> KiB

  Images <span class="hljs-keyword" style="color: #b294bb;">and</span> other types <span class="hljs-keyword" style="color: #b294bb;">of</span> assets omitted.

 DONE  Build complete. The dist directory <span class="hljs-keyword" style="color: #b294bb;">is</span> ready to be deployed.
 INFO  Check <span class="hljs-keyword" style="color: #b294bb;">out</span> deployment instructions <span class="hljs-keyword" style="color: #b294bb;">at</span> https://cli.vuejs.org/guide/deployment.html

Removing intermediate container df514c99701b
 <span class="hljs-comment" style="color: #969896;">---&gt; f7184a45cb6b</span>
Step <span class="hljs-number" style="color: #de935f;">7</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">FROM</span> nginx:stable-alpine as production-stage
stable-alpine: Pulling from library/nginx
cbdbe7a5bc2a: Already exists
<span class="hljs-number" style="color: #de935f;">6</span>ade829cd166: Pull complete
Digest: sha256:<span class="hljs-number" style="color: #de935f;">2668e65</span>e1a36a749aa8b3a5297eee45504a4efea423ec2affcbbf85e31a9a571
Status: Downloaded newer image <span class="hljs-keyword" style="color: #b294bb;">for</span> nginx:stable-alpine
 <span class="hljs-comment" style="color: #969896;">---&gt; ab94f84cc474</span>
Step <span class="hljs-number" style="color: #de935f;">8</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">COPY</span> <span class="hljs-comment" style="color: #969896;">--from=build-stage /app/dist /usr/share/nginx/html</span>
 <span class="hljs-comment" style="color: #969896;">---&gt; 8434beddfb05</span>
Step <span class="hljs-number" style="color: #de935f;">9</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">EXPOSE</span> <span class="hljs-number" style="color: #de935f;">80</span>
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in 09a17a45ba18</span>
Removing intermediate container <span class="hljs-number" style="color: #de935f;">09</span>a17a45ba18
 <span class="hljs-comment" style="color: #969896;">---&gt; eafd2720389b</span>
Step <span class="hljs-number" style="color: #de935f;">10</span>/<span class="hljs-number" style="color: #de935f;">10</span> : <span class="hljs-type" style="color: #de935f;">CMD</span> [<span class="hljs-string" style="color: #b5bd68;">"nginx"</span>, <span class="hljs-string" style="color: #b5bd68;">"-g"</span>, <span class="hljs-string" style="color: #b5bd68;">"daemon off;"</span>]
 <span class="hljs-comment" style="color: #969896;">---&gt; Running in c7596bdcab42</span>
Removing intermediate container c7596bdcab42
 <span class="hljs-comment" style="color: #969896;">---&gt; 55339fd8493d</span>
Successfully built <span class="hljs-number" style="color: #de935f;">55339</span>fd8493d
Successfully <span class="hljs-keyword" style="color: #b294bb;">tagged</span> hanu4u89/docker-vuejs-nginx:latest</pre>
<p>The command we used to build the Image from the Dockerfile is</p>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">docker build -t hanu4u89/docker-vuejs-nginx .</pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h3>Step 3: Start the container from the image we have created</h3>
<pre class="hljs" style="background: #1d1f21; color: #c5c8c6; padding: 0.5em;">docker <span class="hljs-built_in" style="color: #de935f;">run</span> -<span class="hljs-keyword" style="color: #b294bb;">it</span> -p <span class="hljs-number" style="color: #de935f;">8080</span>:<span class="hljs-number" style="color: #de935f;">80</span> -d <span class="hljs-comment" style="color: #969896;">--name docker-vuejs-nginx hanu4u89/docker-vuejs-nginx</span></pre>
<p>&nbsp;</p>
<h3>Step 4: Validate the Vue JS Web Application running inside the container</h3>
<p>You should be able to access the website from the Host machine (mac/windows)  at <strong>http://localhost:8080</strong></p>
<p>Hope this helps.</p>
<p>If you like it share it with your friends and bookmark our page.</p>
<p>Cheers,<br />
Hanu</p>
<p>Find me on <a href="https://www.linkedin.com/in/hanumantha-rao-68741827/">LinkedIn</a></p>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/docker-vuejs/">Docker VueJS Example</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Ansible Archive Examples &#8211; Zip files and Directories</title>
		<link>https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=ansible-archive-module-examples</link>
		<pubDate>Fri, 05 Jun 2020 14:38:11 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Ansible]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5199</guid>
		<description><![CDATA[<p>Ansible archive module is an ansible way of compressing the file and creating an archive. Just like the tar and gz command working together. If you are a Linux guy you would easily get this analogy. For windows, Just think of this as a normal winzip or WinRAR programs &#160; Facts of Ansible archive[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/">Ansible Archive Examples &#8211; Zip files and Directories</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>Ansible archive module is an ansible way of compressing the file and creating an archive. Just like the <code>tar</code> and <code>gz</code> command working together. If you are a Linux guy you would easily get this analogy. For windows, Just think of this as a normal <code>winzip</code> or <code>WinRAR</code> programs</p>
<p>&nbsp;</p>
<h2>Facts of Ansible <span style="color: #ed0e64;">archive</span> module</h2>
<ul>
<li>This command is the opposite of <code>unarchive</code> command of ansible</li>
<li>By default, it assumes the source file you are trying to compress does exist.</li>
<li>It will not copy the source file from the local system to the target before archiving.</li>
<li>Source files can be deleted after archival by specifying <em>remove=True</em></li>
<li>Requires tarfile, zipfile, gzip and bzip2 packages on target host.</li>
<li>Requires lzma or backports.lzma if using xz format.</li>
<li>Can produce <em>gzip</em>, <em>bzip2</em>, <em>lzma</em> and <em>zip</em> compressed files or archives.
<div class="admonition note"></div>
</li>
</ul>
<p>&nbsp;</p>
<h2>Ansible Archive module Examples</h2>
<ul>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example1_Compressing_the_Directory_with_TAR">Compressing the Directory with <code>tar</code></a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_2Compressing_the_Directory_with_tar_and_gz">Compressing the Directory with <code>tar</code> and <code>gz</code></a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_3_Compress_the_file_Default_File_Compress_format">Compress the file with default type <code>gz</code></a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_4_Remove_the_Source_files_after_archiving">Remove the Source files after adding to the archive and compressed</a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_5_Create_a_ZIP_file_archive_File_and_Directory">How to Create a <code>zip</code> archive with Ansible archive module</a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_6_Create_a_BZIP_archive_File_and_Directory">How to Create a <code>bz2</code> archive with Ansible archive module</a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_7_Compressing_and_Archiving_multiple_files_Ansible_archive">Archive Multiple files from multiple Directories with few exclusions</a></li>
<li><a href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/?preview_id=5199&amp;preview_nonce=cf925d9a09&amp;_thumbnail_id=-1&amp;preview=true#Example_8_Ansible_archive_multiples_files_with_loop_multiple_single_files">Ansible archive multiples files with loop &#8211; multiple single files</a></li>
</ul>
<p>&nbsp;</p>
<h3>Example1: Compressing the Directory with TAR</h3>
<p>As mentioned above, Ansible creates various types of archives and the most famous and widely used is <code>tar</code> archive.  In this example we show how to compress a directory using tar with Ansible Archive module.</p>
<p>The Playbook is simple and ansible archive module takes only three arguments</p>
<p><code>path</code> &#8211; Source path on the target machine</p>
<p><code>dest</code> &#8211; Destination Path on the target machine, the resulting file name</p>
<p><code>format</code> &#8211; tar file</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress Directory contents
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat
<span class="hljs-attr">        dest:</span> /apps/tomcat.tar  
<span class="hljs-attr">        format:</span> tar</span></pre>
<p>&nbsp;</p>
<blockquote><p><strong> What if the source file is not present on the target ?</strong></p>
<p>The Task would fail with path does not exist, Ansible archive just presumes that the   source file is present</p></blockquote>
<p>&nbsp;</p>
<h3>Example 2:Compressing the Directory with tar and gz</h3>
<p>If you are familiar with the Linux commands, you might agree with me, we tend to use the <code>tar cvfz</code> command more than <code>tar -cvf</code></p>
<p>because the tar just archive the files and not compress them, rather doing this at two steps, we mostly use <code>tar cvfz</code> to create the compressed archive file.</p>
<p>In this example,  we are going to do the same thing</p>
<p>There are two ways to create the <code>tar.gz</code> or <code>.tgz</code> file ( both are same don&#8217;t get confused )</p>
<p><strong>Method1:</strong> Mention it Explicitly with the format attribute</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress Directory contents
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat
<span class="hljs-attr">        dest:</span> /apps/tomcat.tar.gz
<span style="color: #993300;"><span class="hljs-attr">        format:</span> gz</span></span></pre>
<p>&nbsp;</p>
<p><strong>Method2:</strong> Do not mention any format attribute. As <code>tar.gz</code> is the default when the <code>format</code> is not mentioned and the file type is a directory</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress Directory contents
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat
<span class="hljs-attr">        dest:</span> /apps/tomcat.tar.gz
</span></pre>
<p>&nbsp;</p>
<h3>Example 3: Compress the file &#8211; Default File Compress format</h3>
<p>As we have mentioned previously on the Example2, the default compression type for the directory when the format is not mentioned is <code>tar.gz</code></p>
<p>Likewise, for the file the default compression and archive type is <code>.gz</code> when no format is explicitly mentioned</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress the file using Default format
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/conf/server.xml
<span class="hljs-attr">        dest:</span> /apps/tomcat/server.xml.gz</span></pre>
<p>&nbsp;</p>
<h3>Example 4:  Remove the Source files after archiving</h3>
<p>Most of the time the purpose of doing the archival process is to save some disk space and storage. So once the source file is archived &amp; compressed the source file is no longer needed.</p>
<p>Especially when we are handling the logs and system housekeeping tasks, we would want to remove the old file once the compression is done.</p>
<p>There is a parameter you can use to enable that by default it is disabled.</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress the file and remove
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span class="hljs-attr">        path:</span> /apps/tomcat/logs/localhost-access.log
<span class="hljs-attr">        dest:</span> /apps/tomcat/localhost-access.log.gz
<span style="color: #800080;"><span class="hljs-attr">        remove:</span> <span class="hljs-literal">yes</span></span></pre>
<p>&nbsp;</p>
<blockquote><p><strong>Note*</strong>  When you are compressing the directory with <code>bz2</code> or <code>gz</code> Ansible archive module first archive the directory with <code>tar</code> and then apply the compressing technique on the resulting file. So its not necassary that you have to create a tar ball first before trying to compress.</p>
<p>It does not apply to the <code>zip</code> format. Zip does not create the tarball before compressing it. so if you <code>unzip</code> the archive file you will directly get the files not the tarball while the farmer two would give you the tarball which you have to further extract</p>
<p>&nbsp;</p></blockquote>
<h3>Example 5:  Create a ZIP file archive &#8211; File and Directory</h3>
<p>Note*: for this command to work you should have the <code>zipfile</code> package installed on the target machine</p>
<p>Here is the ansible-playbook  with ansible archive module to <strong>zip a</strong> <strong>Single file </strong>we have also used the remove parameter to delete the original file once the compress is done</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress Directory contents
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/logs/catalina<span class="hljs-number">.2019</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-24.</span>log
<span class="hljs-attr">        dest:</span> /apps/tomcat/catalina<span class="hljs-number">.2019</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-24.</span>log.zip</span>
<span style="color: #800080;"><span class="hljs-attr">        format:</span> zip</span>
<span class="hljs-attr">        remove:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span></pre>
<p>&nbsp;</p>
<p>Here is the ansible-playbook to <strong>zip a directory</strong> using ansible unarchive module in the zip format</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress Directory contents using ZIP
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat
<span class="hljs-attr">        dest:</span> /apps/tomcat-bkp.tar.zip
<span class="hljs-attr">        format:</span> zip</span></pre>
<p>&nbsp;</p>
<h3>Example 6:  Create a BZIP archive &#8211; File and Directory</h3>
<p>In this example, we are going to use the much powerful and reliable Bzip2 to archive the files, bzip2 is by far the best product amongst others and the resulting archive file size would be small than the other ones so you could save some more disk space.</p>
<p>Refer my comparison of all archive formats like <code>bz2</code> <code>zip</code> <code>gz</code> at the end of this post</p>
<p>Back to the subject, Here is the playbook we are going to use to <code>bzip</code> the file and directory I combined both of the tasks into a Single playbook to save some space</p>
<p>All we have to change here is the format from the previous example. As usual the directory compression would be a compressed tarball.</p>
<p>&nbsp;</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Compress the file using BZ2
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/logs/catalina<span class="hljs-number">.2019</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-24.</span>log
<span class="hljs-attr">        dest:</span> /apps/tomcat/catalina<span class="hljs-number">.2019</span><span class="hljs-bullet">-07</span><span class="hljs-bullet">-24.</span>log.bz2
<span class="hljs-attr">        format:</span> bz2</span>
    
<span class="hljs-attr">    - name:</span> Compress the Directory using BZ2
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/
<span class="hljs-attr">        dest:</span> /apps/tomcat-bkp.tar.bz2
<span class="hljs-attr">        format:</span> bz2</span></pre>
<p>&nbsp;</p>
<h3>Example 7:  Compressing and Archiving multiple files Ansible archive</h3>
<p>We saved the little complex and the best for the last and here we have collected few interesting examples as follows</p>
<ul>
<li>Use a Wild card to select the files</li>
<li>Exclude a few specific files while adding the rest into the archive</li>
<li>Take files from multiple source path while creating the archive</li>
</ul>
<p>Here is the playbook  that covers and solves all these three questions</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>
<span class="hljs-attr">    - name:</span> Using Wild card and choosing the catalina logs only
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/logs/catalina*.log</span>
<span class="hljs-attr">        dest:</span> /apps/tomcat/catalinalogs.tar.bz2
<span class="hljs-attr">        format:</span> bz2

<span class="hljs-attr">    - name:</span> Using Wild card and choosing the access logs only
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> /apps/tomcat/logs/*access*.txt</span>
<span class="hljs-attr">        dest:</span> /apps/tomcat/accesslogs.tar.bz2
<span class="hljs-attr">        format:</span> bz2

    <span class="hljs-comment" style="color: #738191;"># Archive all the logs except access logs</span>
<span class="hljs-attr">    - name:</span> Using wild card for Including and Excluding
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      archive:</span>
<span style="color: #800080;"><span class="hljs-attr">        path:</span> 
<span class="hljs-bullet">        -</span> /apps/tomcat/logs/*
<span class="hljs-bullet">        -</span> /var/log/tomcat/*</span>
<span class="hljs-attr">        dest:</span> /apps/tomcat/logfiles.tar.bz2
<span class="hljs-attr">        format:</span> bz2
<span style="color: #800080;"><span class="hljs-attr">        exclude_path:</span>
<span class="hljs-bullet">        -</span> /apps/tomcat/logs/*access*.txt
<span class="hljs-bullet">        -</span> /var/log/tomcat/*access*.txt
</span></pre>
<p>The first two are too self-descriptive we just use the wild card character to select specific files for our archiving process but the third one is a little tricky but great.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM.png"><img class="alignnone size-full wp-image-5394" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM.png" alt="" width="2490" height="1554" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM.png 2490w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM-300x187.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM-768x479.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-5.59.36-PM-1024x639.png 1024w" sizes="(max-width: 2490px) 100vw, 2490px" /></a></p>
<p>If you look at it, we have two parameters here. One is <code>path</code> which is to select the files from the different source location and it is too generic as it has just <code>*</code>  wild card character so it would take everything under those directories irrespective of their type, extension etc.</p>
<p>Now let&#8217;s suppose we are sending these logs to the third party for analysis but don&#8217;t want to give out your user info which is captured in the access log file.  we can exclude the access log files alone using <code>exclude_path</code> parameter.</p>
<p>If you want to know the list of files <code>archived</code> and <code>excluded</code> you can write your own debug task in your playbook or you can simply execute your playbook with more verbose/debug levels like <code>-vvv</code></p>
<pre>ansible-playbook  playbook.yaml -vvv</pre>
<p>In the result, you would be able to see two return variables named <code>archived</code> and <code>expanded_exclude_paths</code></p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM.png"><img class="alignnone size-full wp-image-5393" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM.png" alt="" width="2400" height="1230" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM.png 2400w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM-300x154.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM-768x394.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-01-at-6.24.41-PM-1024x525.png 1024w" sizes="(max-width: 2400px) 100vw, 2400px" /></a></p>
<p>&nbsp;</p>
<h3>Example 8:  Ansible archive multiples files with loop &#8211; multiple single files</h3>
<p>So far the examples we have seen are about creating a Single Archive file with multiple source files in it. Now we are going to see how to create archive on multiple single files.</p>
<p>Now we are going to see, How to Zip a list of files with Ansible archive module.</p>
<p>To be more precise, let me give a requirement here, Let&#8217;s suppose that we want to compress the yesterday log files exactly at 00:01 AM every day.  earlier we used to write Shell scripts to first find the files and then archive each of them. Something like this</p>
<pre>find /apps/tomcat/logs -name "*.log" -mtime +1 -exec gzip {} \;

(or)

find /apps/tomcat/logs -name "*.log" -mtime +1 | xargs gzip</pre>
<p>Here is the Ansible playbook which exactly does the same thing but using the<a href="https://www.middlewareinventory.com/blog/ansible-find-examples/"> Ansible Find module</a> and Ansible Archive module instead of the Shell commands</p>
<p>I insist you read the comments on the Playbook to understand it better.</p>
<p>In a Summary. We have two tasks first task  is with Ansible find module to find files under <code>/apps/tomcat/logs</code> with different extensions, this extension filtering is achieved using the <code>patterns</code>  this task would run and store the file names into a output variable named <code>output</code>  which will be used by ansible archive.</p>
<p>The second task is with Ansible archive module and <code>with_items</code> loop iteration where we iterate through the <code>output</code> variables we got from the ansible find module task and, we are passing each module as a <code>path</code> parameter and doing the normal compression using <code>bz2</code> format.</p>
<p>One special thing we added in our second task is appending the date as we are compressing and archiving each file for better tracking. ( Ideally, that&#8217;s what we do in the realtime log management )</p>
<p><code>ansible_date_time.date.replace('-','')</code>  this is an ansible built-in variable</p>
<p>&nbsp;</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #eaeef3; color: #00193a;"><span class="hljs-meta" style="color: #4c81c9;">---</span>
<span class="hljs-attr"> - name:</span> Ansible archive Examples
<span class="hljs-attr">   user:</span> vagrant
<span class="hljs-attr">   hosts:</span> testserver
<span class="hljs-attr">   tasks:</span>

<span class="hljs-bullet" style="color: #4c81c9;">    -</span> name : Find files ending with extensions
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">true</span>
<span class="hljs-attr">      find:</span>
<span class="hljs-attr">       paths:</span> /apps/tomcat/logs
<span class="hljs-attr">       file_type:</span> file
       <span class="hljs-comment" style="color: #738191;"><span style="color: #993366;"># find files with different extensions</span> </span>
<span class="hljs-attr">       patterns:</span> 
<span class="hljs-bullet" style="color: #4c81c9;">         -</span> <span class="hljs-string" style="color: #0048ab;">'.*\.log$'</span>
<span class="hljs-bullet" style="color: #4c81c9;">         -</span> <span class="hljs-string" style="color: #0048ab;">'.*\.out$'</span>
<span class="hljs-bullet" style="color: #4c81c9;">         -</span> <span class="hljs-string" style="color: #0048ab;">'.*\.txt$'</span>
<span class="hljs-attr">       use_regex:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">       age:</span> <span class="hljs-number">1</span>d
<span class="hljs-attr">       age_stamp:</span> mtime
<span class="hljs-attr">      register:</span> output

<span class="hljs-attr">    - name:</span> archive the files
<span class="hljs-attr">      become:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
<span class="hljs-attr">      become_user:</span> tomcat
<span class="hljs-attr">      archive:</span>
<span class="hljs-attr">        remove:</span> <span class="hljs-literal" style="color: #0048ab;">yes</span>
        <span class="hljs-comment" style="color: #993366;"># Receive Each Element from the Loop</span>
<span class="hljs-attr">        path:</span> <span class="hljs-string" style="color: #0048ab;">"<span class="hljs-template-variable" style="color: #4c81c9;">{{ item.path }}</span>"</span>
        <span class="hljs-comment" style="color: #993366;"># Creating a file with Date filename-DDMMYY.bz2 format</span>
<span class="hljs-attr">        dest:</span> <span class="hljs-string" style="color: #0048ab;">"<span class="hljs-template-variable" style="color: #4c81c9;">{{ item.path }}</span>-<span class="hljs-template-variable" style="color: #4c81c9;">{{ansible_date_time.date.replace('-','')}}</span>.bz2"</span>
<span class="hljs-attr">        format:</span> bz2
      <span class="hljs-comment" style="color: #993366;"># Loop Statement, Goes through the find command output array</span>
<span class="hljs-attr">      with_items:</span> <span class="hljs-string" style="color: #0048ab;">"<span class="hljs-template-variable" style="color: #4c81c9;">{{ output.files }}</span>"</span>
</pre>
<p>The result would be something like this</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM.png"><img class="alignnone size-full wp-image-5399" src="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM.png" alt="" width="1642" height="874" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM.png 1642w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM-300x160.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM-768x409.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/06/Screenshot-2020-06-05-at-7.56.48-PM-1024x545.png 1024w" sizes="(max-width: 1642px) 100vw, 1642px" /></a></p>
<p>&nbsp;</p>
<h2>How to Unarchive the files with Ansible &#8211; Additional</h2>
<p>So far we learnt how to archive the files the other part of this equation is to unarchive these files.  For unarchiving you should use ansible unarchive module.</p>
<p>I wrote an article on the same. Check that out</p>
<blockquote class="wp-embedded-content" data-secret="D86qPNr0RV"><p><a href="https://www.middlewareinventory.com/blog/ansible-unarchive-module-examples/">Ansible Unarchive Module Examples</a></p></blockquote>
<p><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" src="https://www.middlewareinventory.com/blog/ansible-unarchive-module-examples/embed/#?secret=D86qPNr0RV" data-secret="D86qPNr0RV" width="600" height="338" title="&#8220;Ansible Unarchive Module Examples&#8221; &#8212; Middleware Inventory" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></p>
<p>&nbsp;</p>
<p>Cheers<br />
Sarav AK</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/ansible-archive-module-examples/">Ansible Archive Examples &#8211; Zip files and Directories</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>BitBucket List All Repositories &#8211; using REST API</title>
		<link>https://www.middlewareinventory.com/blog/bitbucket-list-repositories/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=bitbucket-list-repositories</link>
		<pubDate>Sun, 24 May 2020 14:44:00 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[BitBucket]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5366</guid>
		<description><![CDATA[<p>How to list all repositories in BitBucket, the same question I had and when I was searching in the community I found a script and I made some modifications on top of it and sharing it with you all. So, I hope you are all aware that BitBucket has the[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/bitbucket-list-repositories/">BitBucket List All Repositories &#8211; using REST API</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>How to list all repositories in BitBucket, the same question I had and when I was searching in the community I found a script and I made some modifications on top of it and sharing it with you all.</p>
<p>So, I hope you are all aware that BitBucket has the REST API interface which can be invoked by sending your bitbucket credentials in <code>BasicAuth</code> headers and it reveals pretty much all the info what their UI does.</p>
<p>Documentation on BitBucket Rest API <a href="https://developer.atlassian.com/cloud/bitbucket/announcement-06-08-18-new-v2-apis/">can be found here</a></p>
<h2><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM.png"><img class="alignnone size-full wp-image-5379" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM.png" alt="" width="3254" height="1632" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM.png 3254w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM-300x150.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM-768x385.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM-1024x514.png 1024w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-24-at-8.16.45-PM-840x420.png 840w" sizes="(max-width: 3254px) 100vw, 3254px" /></a></h2>
<h2>Testing the <span style="color: #e6256f;">BitBucket</span> <span style="color: #e6256f;">Rest API</span> in postman</h2>
<p>Here is the postman sample screenshot</p>
<p>You have to use the API endpoint along with your team name or account identifier. Something like  <a href="https://api.bitbucket.org/2.0/repositories/gritfy">https://api.bitbucket.org/2.0/repositories/gritfy</a></p>
<p>Choose the Basic Auth and Enter the Username and Password and send a request and that&#8217;s all. You would see the data being returned.</p>
<p>The result is usually JSON data.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan.png"><img class="alignnone size-full wp-image-5369" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan.png" alt="" width="2148" height="1822" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan.png 2148w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan-300x254.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan-768x651.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/BitBucketPostMan-1024x869.png 1024w" sizes="(max-width: 2148px) 100vw, 2148px" /></a></p>
<p>&nbsp;</p>
<h2>Filtering the outputs with <span style="color: #e6256f;">Filter</span> Query</h2>
<p>The Rest API, by default, provides a lot of information which is not needed in all the cases. Especially for our current requirement of listing the repository names and their URLs</p>
<p>So you can use the <code>fields</code> query string in your API call like shown below to choose a specific JSON data, in our case it is <code>values.links</code></p>
<pre>https://api.bitbucket.org/2.0/repositories/myrepo?<strong>fields=values.links</strong></pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2>Enabling the <span style="color: #e6256f;">Pagination</span> when you have more Repositories</h2>
<p>When you have a huge number of repositories rather letting the API call run for a long time you can actually do the pagination and load on demand.</p>
<p>The BitBucket Rest API also provides a way to handle the pagination when you have more number of repositories to handle and when you do not want to wait indefinitely</p>
<pre>https://api.bitbucket.org/2.0/repositories/myrepo?<strong>pagelen=10</strong></pre>
<p>For example, if you have 100 repositories in your bitbucket with pagination you can load it for 10 times.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2>Python Script to <span style="color: #e6256f;">List All Repositories</span> in BitBucket</h2>
<p>Here is the python script designed to list all repositories in your BitBucket this also handle the <code>pagelen</code> and <code>fields</code></p>
<p>The endpoint URL we are using here is this.</p>
<pre>https://api.bitbucket.org/2.0/repositories/myrepo?pagelen=10&amp;fields=next,values.links.clone.href,values.slug</pre>
<p>Here is the complete script</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="hljs-keyword" style="color: #333333; font-weight: bold;">import</span> requests
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">from</span> requests.auth <span class="hljs-keyword" style="color: #333333; font-weight: bold;">import</span> HTTPBasicAuth

<span class="hljs-comment" style="color: #999988; font-style: italic;">##Login</span>
username = <span class="hljs-string" style="color: #dd1144;">'username'</span>
password = <span class="hljs-string" style="color: #dd1144;">'password'</span>
team = <span class="hljs-string" style="color: #dd1144;">'myteam'</span>

full_repo_list = []

<span class="hljs-comment" style="color: #999988; font-style: italic;"># Request 100 repositories per page (and only their slugs), and the next page URL</span>
next_page_url = <span class="hljs-string" style="color: #dd1144;">'https://api.bitbucket.org/2.0/repositories/%s?pagelen=10&amp;fields=next,values.links.clone.href,values.slug'</span> % team

<span class="hljs-comment" style="color: #999988; font-style: italic;"># Keep fetching pages while there's a page to fetch</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">while</span> next_page_url <span class="hljs-keyword" style="color: #333333; font-weight: bold;">is</span> <span class="hljs-keyword" style="color: #333333; font-weight: bold;">not</span> <span class="hljs-keyword" style="color: #333333; font-weight: bold;">None</span>:
  response = requests.get(next_page_url, auth=HTTPBasicAuth(username, password))
  page_json = response.json()

  <span class="hljs-comment" style="color: #999988; font-style: italic;"># Parse repositories from the JSON</span>
  <span class="hljs-keyword" style="color: #333333; font-weight: bold;">for</span> repo <span class="hljs-keyword" style="color: #333333; font-weight: bold;">in</span> page_json[<span class="hljs-string" style="color: #dd1144;">'values'</span>]:
    reponame=repo[<span class="hljs-string" style="color: #dd1144;">'slug'</span>]
    repohttp=repo[<span class="hljs-string" style="color: #dd1144;">'links'</span>][<span class="hljs-string" style="color: #dd1144;">'clone'</span>][<span class="hljs-number" style="color: teal;">0</span>][<span class="hljs-string" style="color: #dd1144;">'href'</span>].replace(<span class="hljs-string" style="color: #dd1144;">'SaravThangaraj@'</span>,<span class="hljs-string" style="color: #dd1144;">''</span>)
    repogit=repo[<span class="hljs-string" style="color: #dd1144;">'links'</span>][<span class="hljs-string" style="color: #dd1144;">'clone'</span>][<span class="hljs-number" style="color: teal;">1</span>][<span class="hljs-string" style="color: #dd1144;">'href'</span>]

    <span class="hljs-keyword" style="color: #333333; font-weight: bold;">print</span>  reponame+<span class="hljs-string" style="color: #dd1144;">","</span>+repohttp+<span class="hljs-string" style="color: #dd1144;">","</span>+repogit
    full_repo_list.append(repo[<span class="hljs-string" style="color: #dd1144;">'slug'</span>])
    

  <span class="hljs-comment" style="color: #999988; font-style: italic;"># Get the next page URL, if present</span>
  <span class="hljs-comment" style="color: #999988; font-style: italic;"># It will include same query parameters, so no need to append them again</span>
  next_page_url = page_json.get(<span class="hljs-string" style="color: #dd1144;">'next'</span>, <span class="hljs-keyword" style="color: #333333; font-weight: bold;">None</span>)

<span class="hljs-comment" style="color: #999988; font-style: italic;"># Result length will be equal to `size` returned on any page</span>

<span class="hljs-keyword" style="color: #333333; font-weight: bold;">print</span> (<span class="hljs-string" style="color: #dd1144;">"Result:"</span>, len(full_repo_list))</pre>
<p>The result would be <code>Comma Separated Values(CSV)</code> which you can redirect to some file with <code>.csv</code> extension which can be opened in excel for better readability and formatting</p>
<p>&nbsp;</p>
<p>Cheers<br />
SaravAK</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/bitbucket-list-repositories/">BitBucket List All Repositories &#8211; using REST API</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>AWS Terminate EC2 instances &#8211; AWS CLI</title>
		<link>https://www.middlewareinventory.com/blog/aws-terminate-instance/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=aws-terminate-instance</link>
		<pubDate>Fri, 22 May 2020 11:57:04 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[AWS]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5347</guid>
		<description><![CDATA[<p>In AWS infrastructure, We create a lot of EC2 instances on demand and we tend to forget about the stopped instances considering that it is stopped and not being billed for. But the fact is that Even the stopped instances would cost you a couple of pennies in various forms[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/aws-terminate-instance/">AWS Terminate EC2 instances &#8211; AWS CLI</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance.jpeg"><img class="alignnone size-full wp-image-5352" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance.jpeg" alt="" width="2247" height="1500" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance.jpeg 2247w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-300x200.jpeg 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-768x513.jpeg 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-1024x684.jpeg 1024w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-840x560.jpeg 840w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-120x80.jpeg 120w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-360x240.jpeg 360w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-600x400.jpeg 600w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/terminate-ec2-instance-480x320.jpeg 480w" sizes="(max-width: 2247px) 100vw, 2247px" /></a></p>
<p>In AWS infrastructure, We create a lot of EC2 instances on demand and we tend to forget about the stopped instances considering that it is stopped and not being billed for.</p>
<p>But the fact is that Even the stopped instances would cost you a couple of pennies in various forms like</p>
<ul>
<li>Elastic IP Idle Usage</li>
<li>Volume Usage</li>
<li>EBS GP2 Usage etc.</li>
</ul>
<p>Though it would not be much when it adds up to the number of instances It can increase your monthly infrastructure cost by 10%.</p>
<p>So it is indispensable that you keep track of the shutdown or stopped instances and terminate them</p>
<blockquote><p> Please be warned that there is no way to recover the terminated instances in AWS. Termination means deletion so please be cautious and I recommend using <code>--dry-run</code> and <code>--no-dry-run</code> commands for being safe side</p></blockquote>
<p>&nbsp;</p>
<p>If you are new to AWS CLI and have not installed and tried it yet. <a href="https://www.middlewareinventory.com/blog/aws-cli-ec2/">Please follow this article</a> to get it set up before proceeding.</p>
<p>&nbsp;</p>
<h2>Simply terminate the running instance</h2>
<p>To terminate the instance using AWS CLI you must get hold of the instance ID of the instance. you can get the instance ID using the <code>aws ec2 describe-instances</code> command.   (<a href="https://www.middlewareinventory.com/blog/aws-cli-ec2/">this article could help you</a> )</p>
<p>Once you know the instance Id you can execute the <code>terminate-instance</code> command like this</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;"># <span style="color: #000000;">aws ec<span class="hljs-number">2</span> terminate-instances --instance-ids i<span class="hljs-number">-1234567890</span>abcdef<span class="hljs-number">0</span></span>
{
    <span class="hljs-attr">"TerminatingInstances"</span>: [
        {
            <span class="hljs-attr">"InstanceId"</span>: <span class="hljs-string" style="color: #dd1144;">"i-1234567890abcdef0"</span>,
            <span class="hljs-attr">"CurrentState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">32</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"shutting-down"</span>
            },
            <span class="hljs-attr">"PreviousState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">16</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"running"</span>
            }
        }
    ]
}</pre>
<p>&nbsp;</p>
<h2>AWS Terminate multiple instances at once</h2>
<p>Terminate instances accepts multiple instance-ids at once. You can define N number of <code>instance-ids</code> one after another with <code>space</code> as a delimiter</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;"># aws ec<span class="hljs-number" style="color: teal;">2</span> terminate-instances --instance-ids i<span class="hljs-number" style="color: teal;">-0</span>aac<span class="hljs-number" style="color: teal;">8</span>d<span class="hljs-number" style="color: teal;">3</span>e<span class="hljs-number" style="color: teal;">6</span><span class="hljs-number" style="color: teal;">2</span><span class="hljs-number" style="color: teal;">7</span>de<span class="hljs-number" style="color: teal;">8</span><span class="hljs-number" style="color: teal;">2</span><span class="hljs-number" style="color: teal;">2</span>a  i<span class="hljs-number" style="color: teal;">-00</span>d<span class="hljs-number" style="color: teal;">4</span><span class="hljs-number" style="color: teal;">7</span>a<span class="hljs-number" style="color: teal;">0</span>fedbb<span class="hljs-number" style="color: teal;">9</span>c<span class="hljs-number" style="color: teal;">6</span>f<span class="hljs-number" style="color: teal;">0</span> 
{
    <span class="hljs-attr">"TerminatingInstances"</span>: [
        {
            <span class="hljs-attr">"InstanceId"</span>: <span class="hljs-string" style="color: #dd1144;">"i-0aac8d3e627de822a"</span>,
            <span class="hljs-attr">"CurrentState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">48</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"terminated"</span>
            },
            <span class="hljs-attr">"PreviousState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">80</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"stopped"</span>
            }
        },
        {
            <span class="hljs-attr">"InstanceId"</span>: <span class="hljs-string" style="color: #dd1144;">"i-00d47a0fedbb9c6f0"</span>,
            <span class="hljs-attr">"CurrentState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">48</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"terminated"</span>
            },
            <span class="hljs-attr">"PreviousState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">80</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"stopped"</span>
            }
        }
  ]
}</pre>
<p>&nbsp;</p>
<h2>AWS CLI Command to<span style="color: #e61964;"> List the Stopped instances</span> with the date of Shutdown.</h2>
<p>The following aws cli command would list the stopped instances for you</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">aws ec2 describe-instances 
-<span class="ruby">-filters <span class="hljs-string" style="color: #dd1144;">"Name=instance-state-code,Values=80"</span> 
</span>-<span class="ruby">-query <span class="hljs-string" style="color: #dd1144;">'Reservations[].Instances[].[Tags[?Key==`Name`] | [0].Value, InstanceId, PublicIpAddress, State.Name, StateTransitionReason]'</span> 
</span>-<span class="ruby">-output table</span></pre>
<p>It would print the instance name, instance id, Public IP, Current state (stopped) and the date when it was shut down and why</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM.png"><img class="alignnone size-full wp-image-5350" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM.png" alt="" width="2836" height="1076" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM.png 2836w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM-300x114.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM-768x291.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-22-at-4.21.44-PM-1024x389.png 1024w" sizes="(max-width: 2836px) 100vw, 2836px" /></a></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p>&nbsp;</p>
<h2>List the Stopped instances which are shut down by <span style="color: #e61964;">filtering</span> the year</h2>
<p>Let&#8217;s suppose you want to get rid of the instances which are stopped from 2011 to 2019. you can write your aws ec2 cli query like this and it would find the instances for you</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">aws ec2 describe-instances  
--filters <span class="hljs-string" style="color: #dd1144;">"Name=instance-state-code,Values=80"</span> <span class="hljs-string" style="color: #dd1144;">"Name=reason,Values=*2011*,*2012*,*2013*,*2014*,*2015*,*2016*,*2017*,*2018*,*2019*"</span> 
--query <span class="hljs-string" style="color: #dd1144;">'Reservations[].Instances[].[Tags[?Key==`Name`] | [0].Value, InstanceId, PrivateIpAddress, State.Name, StateTransitionReason]'</span> 
--output table</pre>
<p>Here we are explicitly defining years in the filter you can add or remove the years based on your need and create different filters of your own like by month, year etc.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p>&nbsp;</p>
<h2><span style="color: #e61964;">Terminate</span> the EC2 instances from the output of Describe-instance ( Dryrun First )</h2>
<p>Having found the list of instances already you can terminate all of them which is our objective. You can write nested AWS CLI Query like this  and get it done</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">aws ec2 terminate-instances 
--dry-run
--instance-ids `aws ec2 describe-instances  --filters <span class="hljs-string" style="color: #dd1144;">"Name=instance-state-code,Values=80"</span> <span class="hljs-string" style="color: #dd1144;">"Name=reason,Values=*2011*,*2012*,*2013*,*2014*,*2015*,*2016*,*2017*,*2018*,*2019*"</span> --query <span class="hljs-string" style="color: #dd1144;">'Reservations[].Instances[].[InstanceId]'</span> --output text|tr <span class="hljs-string" style="color: #dd1144;">'\n'</span> <span class="hljs-string" style="color: #dd1144;">' '</span>`</pre>
<p>You can simply copy your list command use it with in the <code>`</code> quotes<code></code></p>
<p>Another way of doing this in bash while loop is this</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">aws ec2 describe-instances  --filters <span class="hljs-string" style="color: #dd1144;">"Name=instance-state-code,Values=80"</span> <span class="hljs-string" style="color: #dd1144;">"Name=reason,Values=*2011*,*2012*,*2013*,*2014*,*2015*,*2016*,*2017*,*2018*,*2019*"</span> --query <span class="hljs-string" style="color: #dd1144;">'Reservations[].Instances[].[InstanceId]'</span> --output text|<span class="hljs-keyword" style="color: #333333; font-weight: bold;">while</span> <span class="hljs-built_in" style="color: #0086b3;">read</span> line
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">do</span>
 <span class="hljs-built_in" style="color: #0086b3;">echo</span> <span class="hljs-string" style="color: #dd1144;">"terminating the instance with id <span class="hljs-variable" style="color: teal;">$line</span>"</span>
 aws ec2 terminate-instances --instance-ids <span class="hljs-variable" style="color: teal;">$line</span> --dry-run
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">done</span></pre>
<p>&nbsp;</p>
<p>Both these preceding methods have the <code>--dry-run</code> reasons for safety reasons and to help anyone who is in a rush to copy and execute this snippet. Since this is dry run the termination would not actually happen. It would dry run successfully if you have the necessary permission to terminate the instances. If not it would present an error.</p>
<blockquote><p> If you are confident now and want to terminate the instances. remove the <code>--dry-run</code> flag from the preceding snippet and you can use it.</p></blockquote>
<p>Once you have issued the command for termination without <code>--dry-run</code> or <code>--no-dry-run</code> option you would get JSON output like given below.</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">{
    <span class="hljs-attr">"TerminatingInstances"</span>: [
        {
            <span class="hljs-attr">"InstanceId"</span>: <span class="hljs-string" style="color: #dd1144;">"i-0aac8d3e627de822a"</span>,
            <span class="hljs-attr">"CurrentState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">48</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"terminated"</span>
            },
            <span class="hljs-attr">"PreviousState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">80</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"stopped"</span>
            }
        },
        {
            <span class="hljs-attr">"InstanceId"</span>: <span class="hljs-string" style="color: #dd1144;">"i-00d47a0fedbb9c6f0"</span>,
            <span class="hljs-attr">"CurrentState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">48</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"terminated"</span>
            },
            <span class="hljs-attr">"PreviousState"</span>: {
                <span class="hljs-attr">"Code"</span>: <span class="hljs-number" style="color: teal;">80</span>,
                <span class="hljs-attr">"Name"</span>: <span class="hljs-string" style="color: #dd1144;">"stopped"</span>
            }
        },</pre>
<p>&nbsp;</p>
<p>Hope this article helps you save a couple of pennies in your monthly infrastructure cost and teaches you how to terminate instances in AWS.</p>
<p>Cheers<br />
Sarav AK</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/aws-terminate-instance/">AWS Terminate EC2 instances &#8211; AWS CLI</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>Ansible Template module Examples</title>
		<link>https://www.middlewareinventory.com/blog/ansible-template-module-example/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=ansible-template-module-example</link>
		<pubDate>Mon, 18 May 2020 11:50:20 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Ansible]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5286</guid>
		<description><![CDATA[<p>Ansible template module helps to template a file out to a remote server. Simply put, at runtime ansible template module updates the jinja2 interpolation syntax variables with actual values and copy the template file to the remote server with the specified name. This is most useful for configuration templating and[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/ansible-template-module-example/">Ansible Template module Examples</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>Ansible template module helps to template a file out to a remote server.</p>
<p>Simply put, at runtime ansible template module updates the jinja2 interpolation syntax variables with actual values and copy the template file to the remote server with the specified name.</p>
<p>This is most useful for configuration templating and Server provisioning. We can see more Ansible template and interpolation syntax and Ansible template can be used in detail.</p>
<p>&nbsp;</p>
<h2>What does <span style="color: #e3175e;">Ansible template</span> module do</h2>
<p>Ansible template module does two things</p>
<ol>
<li>Replace the Jinja2 interpolation syntax variables present in the template file with actual values</li>
<li>copy (scp) the file to the remote server.</li>
</ol>
<p>Ansible template module is designed to perform only these two things and it does the same perfectly and before going to Ansible template it is necessary that we should understand  the Ansible interpolation syntax and how it works.</p>
<p>&nbsp;</p>
<h2>Ansible <span style="color: #e61062;">Interpolation Syntax</span> and Variables</h2>
<p>To understand the Ansible template it is necessary that you Ansible interpolation syntax and variables and how it works.</p>
<p>Let us consider the normal shell script where you would have to pass the value of some variable during the time of execution. For example</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;"><span class="hljs-meta" style="font-weight: bold; color: #999999;">#!/bin/bash</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;"># Script find and  type of files which are N days older</span>
<span class="hljs-comment" style="color: #999988; font-style: italic;">#</span>

<span class="hljs-keyword" style="color: #333333; font-weight: bold;">if</span> [ <span class="hljs-variable" style="color: teal;">$#</span> <span class="hljs-_">-ne</span> 3 ]
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">then</span>
    <span class="hljs-built_in" style="color: #0086b3;">echo</span> Please Check and Rerun
    <span class="hljs-built_in" style="color: #0086b3;">echo</span> -------------------------
    <span class="hljs-built_in" style="color: #0086b3;">echo</span> <span class="hljs-string" style="color: #dd1144;">"<span class="hljs-variable" style="color: teal;">$0</span> Directory FileExtension DaysOld"</span>
    <span class="hljs-built_in" style="color: #0086b3;">echo</span> <span class="hljs-variable" style="color: teal;">$0</span> /var/<span class="hljs-built_in" style="color: #0086b3;">log</span>/tomcat <span class="hljs-string" style="color: #dd1144;">"*.log"</span>  30
    <span class="hljs-built_in" style="color: #0086b3;">exit</span>
<span class="hljs-keyword" style="color: #333333; font-weight: bold;">fi</span>

DIR=<span class="hljs-variable" style="color: teal;">$1</span>
FILEEXT=<span class="hljs-variable" style="color: teal;">$2</span>
DAYSOLD=<span class="hljs-variable" style="color: teal;">$3</span>

find <span class="hljs-variable" style="color: teal;">${DIR}</span> -type f -name <span class="hljs-variable" style="color: teal;">${FILEEXT}</span> -mtime +<span class="hljs-variable" style="color: teal;">${DAYSOLD}</span></pre>
<p>the preceding script is to simply perform some find command it takes all its input from the user during the runtime, till we get the right values from the user we have variable names like <code>DIR, FILEEXT, DAYSOLD</code>  as a <code>placeholder</code></p>
<p>when we start the script with the following command</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">./<span class="hljs-keyword" style="color: #333333; font-weight: bold;">test</span>.<span class="hljs-keyword" style="color: #333333; font-weight: bold;">sh</span> <span class="hljs-string" style="color: #dd1144;">"/apps/tomcat"</span> <span class="hljs-string" style="color: #dd1144;">"*.log"</span>  30</pre>
<p>the variable names would be replaced by these actual values and the script would be executed as intended.</p>
<p>Now in the world of Ansible, let&#8217;s suppose you want to perform the same task and get the inputs from the user at run time as variables.</p>
<p>Here is some simple playbook</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM.png"><img class="alignnone size-full wp-image-5326" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM.png" alt="Ansible Template" width="1668" height="484" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM.png 1668w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM-300x87.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM-768x223.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-9.50.17-AM-1024x297.png 1024w" sizes="(max-width: 1668px) 100vw, 1668px" /></a></p>
<p>While starting this playbook with <code>ansible-playbook</code> command you have to declare the variables just like you did with Shell script. this is what is called interpolation.</p>
<p>In Ansible <code>{{ }}</code> is the interpolation syntax whereas in shell script it is <code>${ }</code></p>
<p>Finally, you can start your playbook like this with the variables at runtime.</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; color: #333333; background: #f8f8f8;">ansible-playbook findtest<span class="hljs-selector-class">.yaml</span> -e <span class="hljs-string" style="color: #dd1144;">"DIR=/apps/Tomcat FILEEXT=*.log DAYSOLD=30"</span></pre>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p>&nbsp;</p>
<h2>Quick <span style="color: #e3175e;">Example</span> of Ansible <span style="color: #e3175e;">template</span> module</h2>
<p>we are going to make some modifications in our previous shell script and going to the change the interpolation from Shell <code>${ }</code> into Ansible Jinja 2 interpolation syntax <code>{{ }}</code></p>
<h3>Shell Script &#8211; A Source file with Jinja2 interpolation</h3>
<div>
<pre>#!/bin/bash

# Script find and type of files which are N days older

find <span style="color: #993366;">{{DIR}}</span> -type f -name <span style="color: #993366;">{{FILEEXT}}</span> -mtime +<span style="color: #993366;">{{DAYSOLD}}</span></pre>
</div>
<div>Save this script as <code>test.sh</code> or <code>test.sh.j2</code>   the J2 is an identifier and file extension for Jinja2 files but it&#8217;s not mandatory to save the source/template file with that extension.</div>
<div></div>
<h3>Ansible Playbook with Ansible template</h3>
<div>Here is the ansible playbook to copy this file to the remote server and execute.</div>
<div></div>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;"><span class="hljs-meta" style="color: #9b859d;">---</span>
<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Template Example
<span class="hljs-attr" style="color: #6d9cbe;">      hosts:</span> hostgroup1
<span class="hljs-attr" style="color: #6d9cbe;">      tasks:</span>
<span class="hljs-attr" style="color: #6d9cbe;">        - name:</span> Template module to interpolate variables and copy the file
<span class="hljs-attr" style="color: #6d9cbe;">          template:</span>
<span class="hljs-attr" style="color: #6d9cbe;">            src:</span> test.sh
<span class="hljs-attr" style="color: #6d9cbe;">            dest:</span> /tmp/test.sh
<span class="hljs-attr" style="color: #6d9cbe;">            owner:</span> vagrant
<span class="hljs-attr" style="color: #6d9cbe;">            group:</span> vagrant
<span class="hljs-attr" style="color: #6d9cbe;">            mode:</span> <span class="hljs-number" style="color: #a5c261;">0755</span>
        
<span class="hljs-attr" style="color: #6d9cbe;">        - name:</span> Execute the script
<span class="hljs-attr" style="color: #6d9cbe;">          become:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr" style="color: #6d9cbe;">          shell:</span>
            /tmp/test.sh
<span class="hljs-attr" style="color: #6d9cbe;">          register:</span> scroutput
          
<span class="hljs-attr" style="color: #6d9cbe;">        - debug:</span> var=scroutput.stdout_lines
</pre>
<p>You can notice that there two tasks in the playbook</p>
<ul>
<li><strong>Ansible template </strong>module to take care of the interpolation and scp</li>
<li><strong>Ansible shell</strong> module to invoke the script once the file is placed there.</li>
</ul>
<p>&nbsp;</p>
<h3>Execution output of this Playbook</h3>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM.png"><img class="alignnone size-full wp-image-5327" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM.png" alt="" width="2006" height="1510" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM.png 2006w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM-300x226.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM-768x578.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-12.59.28-PM-1024x771.png 1024w" sizes="(max-width: 2006px) 100vw, 2006px" /></a></p>
<p><script id="asciicast-zPejBclk2128SMlQJwPOwhhW1" src="https://asciinema.org/a/zPejBclk2128SMlQJwPOwhhW1.js" async></script><br />
Ansible Template file is used for various configuration files and to achieve configuration templating. The following example would give you a clear picture if you still have questions on the ansible template.</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<h2><span style="color: #e3175e;">Configuration</span> Templating with Ansible Template Example</h2>
<p>Ansible templating is widely used in Ansible roles for those who are not aware of what is ansible roles, it would be little hard to grab but if you do it a couple of times you can easily understand I bet.</p>
<p>So I have taken the Apache httpd server setup as an example. We have created ansible role for installing and configuration apache httpd server it performs everything right from downloading the <code>epel</code> repo and installing <code>apache</code></p>
<p>The <code>setup-apache</code> role is also designed to download the current and live copy of <code>middlewainventory.com</code>  and create an <code>index.html</code> file for the apache virtual host</p>
<blockquote><p>  Github Repo URL : <a href="https://github.com/AKSarav/Ansible-SetupApacheRole">https://github.com/AKSarav/Ansible-SetupApacheRole</a></p></blockquote>
<p>File and Folder structure of my local machine where am testing this role</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM.png"><img class="alignnone size-full wp-image-5328" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM.png" alt="" width="1086" height="766" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM.png 1086w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM-300x212.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM-768x542.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-18-at-3.55.13-PM-1024x722.png 1024w" sizes="(max-width: 1086px) 100vw, 1086px" /></a></p>
<p>here <code>template-ex2.yml</code> is our main playbook which invokes the role and here is the content of that file</p>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;"><span class="hljs-bullet" style="color: #6d9cbe;">-</span>-- 
<span class="hljs-attr" style="color: #6d9cbe;">    - name:</span> Apache2 Setup
<span class="hljs-attr" style="color: #6d9cbe;">      hosts:</span> hostgroup1
<span class="hljs-attr" style="color: #6d9cbe;">      handlers:</span>
<span class="hljs-attr" style="color: #6d9cbe;">        - include:</span> handlers/handlers.yaml
<span class="hljs-attr" style="color: #6d9cbe;">      roles:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">        -</span> setup-apache
</pre>
<p>Here is the content of our <code>setup-apache/tasks/main.yml</code> content which is heart of our role does all the job for us</p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<pre class="hljs" style="display: block; overflow-x: auto; padding: 0.5em; background: #232323; color: #e6e1dc;"><span class="hljs-meta" style="color: #9b859d;">---</span>
<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> install the EPEL release rpm 
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  yum:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    name:</span> http://dl.fedoraproject.org/pub/epel/epel-release-latest<span class="hljs-bullet" style="color: #6d9cbe;">-7.</span>noarch.rpm
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> present

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Ensure Apache is at the Latest version
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  yum:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    name:</span> httpd
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> latest

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> <span class="hljs-string" style="color: #a5c261;">"Create sites-available and sites-enabled Directories"</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  file:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ item }}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    owner:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">    group:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">    mode:</span> <span class="hljs-number" style="color: #a5c261;">0644</span>
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> directory
<span class="hljs-attr" style="color: #6d9cbe;">  with_items:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> <span class="hljs-string" style="color: #a5c261;">"/etc/httpd/sites-enabled"</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> <span class="hljs-string" style="color: #a5c261;">"/etc/httpd/sites-available"</span>

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Modify the Default Apache Configuration file
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  template:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    src:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ item.src }}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ item.dest }}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    owner:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">    group:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">    mode:</span> <span class="hljs-number" style="color: #a5c261;">0644</span>
<span class="hljs-attr" style="color: #6d9cbe;">  with_items:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> {src: <span class="hljs-string" style="color: #a5c261;">'basic_vh.conf.j2'</span>, dest: <span class="hljs-string" style="color: #a5c261;">'/etc/httpd/sites-available/<span class="hljs-template-variable" style="color: #a5c261;">{{ domain }}</span>.conf'</span>}
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> {src: <span class="hljs-string" style="color: #a5c261;">'httpd.conf.j2'</span>, dest: <span class="hljs-string" style="color: #a5c261;">'/etc/httpd/conf/httpd.conf'</span>}
  
<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Create the Document Root Direcotory
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  file:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{ docroot }}</span>"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    mode:</span> <span class="hljs-number" style="color: #a5c261;">0755</span>
<span class="hljs-attr" style="color: #6d9cbe;">    owner:</span> apache
<span class="hljs-attr" style="color: #6d9cbe;">    group:</span> apache
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> directory

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Symlink the sites-available VH file to sites-enabled 
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  file:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    src:</span> <span class="hljs-string" style="color: #a5c261;">"/etc/httpd/sites-available/<span class="hljs-template-variable" style="color: #a5c261;">{{ domain }}</span>.conf"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> <span class="hljs-string" style="color: #a5c261;">"/etc/httpd/sites-enabled/<span class="hljs-template-variable" style="color: #a5c261;">{{ domain }}</span>.conf"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> link
<span class="hljs-attr" style="color: #6d9cbe;">  notify:</span> restart apache

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Make Sure mime.types file is available
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  file:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> /etc/httpd/conf/mime.types
<span class="hljs-attr" style="color: #6d9cbe;">    state:</span> file
<span class="hljs-attr" style="color: #6d9cbe;">  register:</span> mimeout
<span class="hljs-attr" style="color: #6d9cbe;">  ignore_errors:</span> <span class="hljs-literal">True</span>

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Copy the /etc/mime.types file to httpd conf
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  shell:</span> <span class="hljs-string" style="color: #a5c261;">"cp /etc/mime.types /etc/httpd/conf/mime.types"</span>
<span class="hljs-attr" style="color: #6d9cbe;">  when:</span> mimeout is failed

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Download the home page of www.middlewareinventory.com to tmp
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  shell:</span> 
    wget https://www.middlewareinventory.com
<span class="hljs-attr" style="color: #6d9cbe;">  args:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    chdir:</span> <span class="hljs-string" style="color: #a5c261;">"/tmp"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    creates:</span> <span class="hljs-string" style="color: #a5c261;">"index.html"</span>

<span class="hljs-bullet" style="color: #6d9cbe;">-</span> name : Changing file permission of downloaded index.html and copy to DocRoot
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  copy:</span>
<span class="hljs-attr" style="color: #6d9cbe;">    remote_src:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">    src:</span> <span class="hljs-string" style="color: #a5c261;">"/tmp/index.html"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    dest:</span> <span class="hljs-string" style="color: #a5c261;">"<span class="hljs-template-variable" style="color: #a5c261;">{{docroot}}</span>/index.html"</span>
<span class="hljs-attr" style="color: #6d9cbe;">    owner:</span> apache
<span class="hljs-attr" style="color: #6d9cbe;">    group:</span> apache
<span class="hljs-attr" style="color: #6d9cbe;">    mode:</span> <span class="hljs-number" style="color: #a5c261;">0755</span>

<span class="hljs-attr" style="color: #6d9cbe;">- name:</span> Make Sure the Apache is Running
<span class="hljs-attr" style="color: #6d9cbe;">  tags:</span>
<span class="hljs-bullet" style="color: #6d9cbe;">    -</span> web
<span class="hljs-attr" style="color: #6d9cbe;">  become:</span> <span class="hljs-literal">yes</span>
<span class="hljs-attr" style="color: #6d9cbe;">  become_user:</span> root
<span class="hljs-attr" style="color: #6d9cbe;">  service:</span> name=httpd state=restarted enabled=<span class="hljs-literal">yes</span>
</pre>
<p>We have a <code>handler</code> which can be defined as a <code>function</code> in the general programming, paradigm to declare once and to use it multiple times.</p>
<h3>Video Ansible template example</h3>
<p><iframe width="840" height="630" src="https://www.youtube.com/embed/dMQkMB5X0UA?feature=oembed" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<p>Cheers<br />
Sarav</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/ansible-template-module-example/">Ansible Template module Examples</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
		<item>
		<title>PowerShell tail file &#8211; Windows tail command</title>
		<link>https://www.middlewareinventory.com/blog/powershell-tail-file-windows-tail-command/?utm_source=rss&#038;utm_medium=rss&#038;utm_campaign=powershell-tail-file-windows-tail-command</link>
		<pubDate>Fri, 08 May 2020 03:31:53 +0000</pubDate>
		<dc:creator><![CDATA[admin]]></dc:creator>
				<category><![CDATA[Windows Server]]></category>

		<guid isPermaLink="false">https://www.middlewareinventory.com/?p=5309</guid>
		<description><![CDATA[<p>PowerShell is a powerful tool and it enables the Windows servers to compete with the Shell and Linux command line features. One of the useful command in linux is tail which helps us to view the file as it gets updated mostly used to view the log files. For instance,[...]</p>
<p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/powershell-tail-file-windows-tail-command/">PowerShell tail file &#8211; Windows tail command</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></description>
				<content:encoded><![CDATA[<div id="vuukle-powerbar" class="vuukle-powerbar-vertical powerbarBoxDiv" style="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px; " data-styles="position:fixed;                                                             z-index: 10001;                                                            width: 60px;                                                            max-width: 60px;                                                           left: 10px;                                                             top: 160px;"></div><p>PowerShell is a powerful tool and it enables the Windows servers to compete with the Shell and Linux command line features. One of the useful command in linux is tail which helps us to view the file as it gets updated mostly used to view the log files.</p>
<p>For instance, we start a service and we want to know if the service is coming up and check the errors in the log file, live without having to re-open the file.</p>
<p>Until I was introduced to this PowerShell command method, I was using either <code>baretail</code> or <code>notepad++</code> to tail the log files in Windows</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell.png"><img class="alignnone size-full wp-image-5320" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell.png" alt="powershell tail file" width="1176" height="1056" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell.png 1176w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell-300x269.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell-768x690.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/powershell-1024x920.png 1024w" sizes="(max-width: 1176px) 100vw, 1176px" /></a></p>
<p>&nbsp;</p>
<h2>PowerShell <span style="color: #e01962;">tail</span> Command  <span style="color: #003366;">Get-Content</span></h2>
<p>Powershell has a command named <code>Get-Content</code> it exactly does the job as it was named after. It gets content from the file. This command has a <code>flag</code> or attribute named <code>Tail</code> which make it equivalent to the Linux tail command</p>
<p>Here is a simple tail command equivalent windows powershell Get-Content command.</p>
<pre> Get-Content .\localhost_access_log.2020-05-08.txt <strong>-Tail 10</strong></pre>
<p>Execution result of the preceding command is given below.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM.png"><img class="alignnone size-full wp-image-5310" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM.png" alt="" width="1574" height="452" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM.png 1574w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM-300x86.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM-768x221.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.00.57-AM-1024x294.png 1024w" sizes="(max-width: 1574px) 100vw, 1574px" /></a></p>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-3398911159151128" data-ad-slot="1946393371"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
<p>&nbsp;</p>
<h2>PowerShell <span style="color: #e01962;">tail -f</span> Command  <span style="color: #003366;">Get-Content</span></h2>
<p>the wonderful feature of tail is to watch for changes as it happens and see the live logs as it is getting updated.  which is done using a <code>-f</code> flag in Linux tail command</p>
<p>In windows, the same is achieved with another flag/option named <code>Wait</code></p>
<p>here is the windows PowerShell tail -f command equivalent Get-Content command</p>
<pre>Get-Content .\localhost_access_log.2020-05-08.txt <strong>-Tail 10 -Wait</strong></pre>
<p>In fact, it is the same command as previous but an extra <code>-Wait</code> has been added.</p>
<p><a href="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM.png"><img class="alignnone size-full wp-image-5311" src="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM.png" alt="" width="1552" height="490" srcset="https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM.png 1552w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM-300x95.png 300w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM-768x242.png 768w, https://www.middlewareinventory.com/wp-content/uploads/2020/05/Screenshot-2020-05-08-at-8.53.10-AM-1024x323.png 1024w" sizes="(max-width: 1552px) 100vw, 1552px" /></a></p>
<p>As shown in the screenshot you can see the cursor is at the end of the file it has not returned to terminal and monitoring (or) waiting for more lines to come.</p>
<p>&nbsp;</p>
<h2>Conclusion</h2>
<p>Hope this article helped you to find the Linux Equivalent Windows find command in Powershell and now you know how to tail the log file in windows without using any special tools like baretail etc.</p>
<p>&nbsp;</p>
<p>Cheers<br />
Sarav</p>
<div id="postfollow">
<p>Follow us on <i class="fa fa-facebook"></i> <a href="http://www.facebook.com/middlewareinventory">Facebook</a> or <i class="fa fa-twitter"></i>  <a href="http://www.twitter.com/mwinventory">Twitter</a>
</br>
<i class="fa fa-youtube"></i>For more practical videos and tutorials. <a href="https://www.youtube.com/channel/UCRuqBFM6ioWwviNJkgOjeWw?sub_confirmation=1">Subscribe to our channel</a>
</br>
<i class="fa fa-linkedin"></i>Find me on Linkedin <a href="https://www.linkedin.com/in/saravakmwinventory/">My Profile</a>
</br>
</i>For any Consultation or to hire us <a href="mailto:hello@gritfy.com"> hello@gritfy.com</a>
</br>
</br>
If you like this article. Show your Support! <a href="https://ko-fi.com/middlewareinventory">Buy me a Coffee.</a>
</br>
</br>
<a href='https://ko-fi.com/O4O51FG7C' target='_blank'><img height='46' style='border:0px;height:46px;' src='https://az743702.vo.msecnd.net/cdn/kofi3.png?v=2' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a> 
</p>
</div>
<hr>
<div id="vuukle-emote" style='max-width:600px' class="emotesBoxDiv"></div><p>The post <a rel="nofollow" href="https://www.middlewareinventory.com/blog/powershell-tail-file-windows-tail-command/">PowerShell tail file &#8211; Windows tail command</a> appeared first on <a rel="nofollow" href="https://www.middlewareinventory.com">Middleware Inventory</a>.</p>
]]></content:encoded>
			</item>
	</channel>
</rss>

<!--
Performance optimized by W3 Total Cache. Learn more: https://www.boldgrid.com/w3-total-cache/

Page Caching using disk: enhanced (Page is feed) 
Minified using disk

Served from: www.middlewareinventory.com @ 2020-09-12 07:19:11 by W3 Total Cache
-->